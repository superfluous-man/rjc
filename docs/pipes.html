<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>18 Pipes | R for Data Science (2e)</title>
<meta name="author" content="Hadley Wickham and Garrett Grolemund">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.6/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.4/tabs.js"></script><script src="libs/bs3compat-0.2.4/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script><link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet">
<script src="libs/str_view-binding-1.4.0/str_view.js"></script><link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet">
<script src="libs/leaflet-1.3.1/leaflet.js"></script><link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet">
<script src="libs/proj4-2.6.2/proj4.min.js"></script><script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script><link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet">
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-115082821-1');
    </script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">R for Data Science (2e)</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="introduction.html"><span class="header-section-number">1</span> Introduction</a></li>
<li class="book-part">Explore</li>
<li><a class="" href="explore-intro.html"><span class="header-section-number">2</span> Introduction</a></li>
<li><a class="" href="data-visualisation.html"><span class="header-section-number">3</span> Data visualisation</a></li>
<li><a class="" href="workflow-basics.html"><span class="header-section-number">4</span> Workflow: basics</a></li>
<li><a class="" href="transform.html"><span class="header-section-number">5</span> Data transformation</a></li>
<li><a class="" href="workflow-scripts.html"><span class="header-section-number">6</span> Workflow: scripts</a></li>
<li><a class="" href="exploratory-data-analysis.html"><span class="header-section-number">7</span> Exploratory Data Analysis</a></li>
<li><a class="" href="workflow-projects.html"><span class="header-section-number">8</span> Workflow: projects</a></li>
<li class="book-part">Wrangle</li>
<li><a class="" href="wrangle-intro.html"><span class="header-section-number">9</span> Introduction</a></li>
<li><a class="" href="tibbles.html"><span class="header-section-number">10</span> Tibbles</a></li>
<li><a class="" href="data-import.html"><span class="header-section-number">11</span> Data import</a></li>
<li><a class="" href="tidy-data.html"><span class="header-section-number">12</span> Tidy data</a></li>
<li><a class="" href="relational-data.html"><span class="header-section-number">13</span> Relational data</a></li>
<li><a class="" href="strings.html"><span class="header-section-number">14</span> Strings</a></li>
<li><a class="" href="factors.html"><span class="header-section-number">15</span> Factors</a></li>
<li><a class="" href="dates-and-times.html"><span class="header-section-number">16</span> Dates and times</a></li>
<li class="book-part">Program</li>
<li><a class="" href="program-intro.html"><span class="header-section-number">17</span> Introduction</a></li>
<li><a class="active" href="pipes.html"><span class="header-section-number">18</span> Pipes</a></li>
<li><a class="" href="functions.html"><span class="header-section-number">19</span> Functions</a></li>
<li><a class="" href="vectors.html"><span class="header-section-number">20</span> Vectors</a></li>
<li><a class="" href="iteration.html"><span class="header-section-number">21</span> Iteration</a></li>
<li class="book-part">Model</li>
<li><a class="" href="model-intro.html"><span class="header-section-number">22</span> Introduction</a></li>
<li><a class="" href="model-basics.html"><span class="header-section-number">23</span> Model basics</a></li>
<li><a class="" href="model-building.html"><span class="header-section-number">24</span> Model building</a></li>
<li><a class="" href="many-models.html"><span class="header-section-number">25</span> Many models</a></li>
<li class="book-part">Communicate</li>
<li><a class="" href="communicate-intro.html"><span class="header-section-number">26</span> Introduction</a></li>
<li><a class="" href="r-markdown.html"><span class="header-section-number">27</span> R Markdown</a></li>
<li><a class="" href="graphics-for-communication.html"><span class="header-section-number">28</span> Graphics for communication</a></li>
<li><a class="" href="r-markdown-formats.html"><span class="header-section-number">29</span> R Markdown formats</a></li>
<li><a class="" href="r-markdown-workflow.html"><span class="header-section-number">30</span> R Markdown workflow</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/hadley/r4ds">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="pipes" class="section level1" number="18">
<h1>
<span class="header-section-number">18</span> Pipes<a class="anchor" aria-label="anchor" href="#pipes"><i class="fas fa-link"></i></a>
</h1>
<div id="introduction-11" class="section level2" number="18.1">
<h2>
<span class="header-section-number">18.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-11"><i class="fas fa-link"></i></a>
</h2>
<p>Pipes are a powerful tool for clearly expressing a sequence of multiple operations. So far, you’ve been using them without knowing how they work, or what the alternatives are. Now, in this chapter, it’s time to explore the pipe in more detail. You’ll learn the alternatives to the pipe, when you shouldn’t use the pipe, and some useful related tools.</p>
<div id="prerequisites-11" class="section level3" number="18.1.1">
<h3>
<span class="header-section-number">18.1.1</span> Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites-11"><i class="fas fa-link"></i></a>
</h3>
<p>The pipe, <code><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></code>, comes from the <strong>magrittr</strong> package by Stefan Milton Bache. Packages in the tidyverse load <code><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></code> for you automatically, so you don’t usually load magrittr explicitly. Here, however, we’re focussing on piping, and we aren’t loading any other packages, so we will load it explicitly.</p>
<div class="sourceCode" id="cb440"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org">magrittr</a></span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="piping-alternatives" class="section level2" number="18.2">
<h2>
<span class="header-section-number">18.2</span> Piping alternatives<a class="anchor" aria-label="anchor" href="#piping-alternatives"><i class="fas fa-link"></i></a>
</h2>
<p>The point of the pipe is to help you write code in a way that is easier to read and understand. To see why the pipe is so useful, we’re going to explore a number of ways of writing the same code. Let’s use code to tell a story about a little bunny named Foo Foo:</p>
<blockquote>
<p>Little bunny Foo Foo<br>
Went hopping through the forest<br>
Scooping up the field mice<br>
And bopping them on the head</p>
</blockquote>
<p>This is a popular Children’s poem that is accompanied by hand actions.</p>
<p>We’ll start by defining an object to represent little bunny Foo Foo:</p>
<div class="sourceCode" id="cb441"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">foo_foo</span> <span class="op">&lt;-</span> <span class="fu">little_bunny</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<p>And we’ll use a function for each key verb: <code>hop()</code>, <code>scoop()</code>, and <code>bop()</code>. Using this object and these verbs, there are (at least) four ways we could retell the story in code:</p>
<ol style="list-style-type: decimal">
<li>Save each intermediate step as a new object.</li>
<li>Overwrite the original object many times.</li>
<li>Compose functions.</li>
<li>Use the pipe.</li>
</ol>
<p>We’ll work through each approach, showing you the code and talking about the advantages and disadvantages.</p>
<div id="intermediate-steps" class="section level3" number="18.2.1">
<h3>
<span class="header-section-number">18.2.1</span> Intermediate steps<a class="anchor" aria-label="anchor" href="#intermediate-steps"><i class="fas fa-link"></i></a>
</h3>
<p>The simplest approach is to save each step as a new object:</p>
<div class="sourceCode" id="cb442"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">foo_foo_1</span> <span class="op">&lt;-</span> <span class="fu">hop</span><span class="op">(</span><span class="va">foo_foo</span>, through <span class="op">=</span> <span class="va">forest</span><span class="op">)</span>
<span class="va">foo_foo_2</span> <span class="op">&lt;-</span> <span class="fu">scoop</span><span class="op">(</span><span class="va">foo_foo_1</span>, up <span class="op">=</span> <span class="va">field_mice</span><span class="op">)</span>
<span class="va">foo_foo_3</span> <span class="op">&lt;-</span> <span class="fu">bop</span><span class="op">(</span><span class="va">foo_foo_2</span>, on <span class="op">=</span> <span class="va">head</span><span class="op">)</span></code></pre></div>
<p>The main downside of this form is that it forces you to name each intermediate element. If there are natural names, this is a good idea, and you should do it. But many times, like this in this example, there aren’t natural names, and you add numeric suffixes to make the names unique. That leads to two problems:</p>
<ol style="list-style-type: decimal">
<li><p>The code is cluttered with unimportant names</p></li>
<li><p>You have to carefully increment the suffix on each line.</p></li>
</ol>
<p>Whenever I write code like this, I invariably use the wrong number on one line and then spend 10 minutes scratching my head and trying to figure out what went wrong with my code.</p>
<p>You may also worry that this form creates many copies of your data and takes up a lot of memory. Surprisingly, that’s not the case. First, note that proactively worrying about memory is not a useful way to spend your time: worry about it when it becomes a problem (i.e. you run out of memory), not before. Second, R isn’t stupid, and it will share columns across data frames, where possible. Let’s take a look at an actual data manipulation pipeline where we add a new column to <code><a href="https://ggplot2.tidyverse.org/reference/diamonds.html">ggplot2::diamonds</a></code>:</p>
<div class="sourceCode" id="cb443"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diamonds</span> <span class="op">&lt;-</span> <span class="fu">ggplot2</span><span class="fu">::</span><span class="va"><a href="https://ggplot2.tidyverse.org/reference/diamonds.html">diamonds</a></span>
<span class="va">diamonds2</span> <span class="op">&lt;-</span> <span class="va">diamonds</span> <span class="op">%&gt;%</span> 
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>price_per_carat <span class="op">=</span> <span class="va">price</span> <span class="op">/</span> <span class="va">carat</span><span class="op">)</span>

<span class="fu">pryr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pryr/man/object_size.html">object_size</a></span><span class="op">(</span><span class="va">diamonds</span><span class="op">)</span>
<span class="co">#&gt; Registered S3 method overwritten by 'pryr':</span>
<span class="co">#&gt;   method      from</span>
<span class="co">#&gt;   print.bytes Rcpp</span>
<span class="co">#&gt; 3.46 MB</span>
<span class="fu">pryr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pryr/man/object_size.html">object_size</a></span><span class="op">(</span><span class="va">diamonds2</span><span class="op">)</span>
<span class="co">#&gt; 3.89 MB</span>
<span class="fu">pryr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pryr/man/object_size.html">object_size</a></span><span class="op">(</span><span class="va">diamonds</span>, <span class="va">diamonds2</span><span class="op">)</span>
<span class="co">#&gt; 3.89 MB</span></code></pre></div>
<p><code><a href="https://rdrr.io/pkg/pryr/man/object_size.html">pryr::object_size()</a></code> gives the memory occupied by all of its arguments. The results seem counterintuitive at first:</p>
<ul>
<li>
<code>diamonds</code> takes up 3.46 MB,</li>
<li>
<code>diamonds2</code> takes up 3.89 MB,</li>
<li>
<code>diamonds</code> and <code>diamonds2</code> together take up 3.89 MB!</li>
</ul>
<p>How can that work? Well, <code>diamonds2</code> has 10 columns in common with <code>diamonds</code>: there’s no need to duplicate all that data, so the two data frames have variables in common. These variables will only get copied if you modify one of them. In the following example, we modify a single value in <code>diamonds$carat</code>. That means the <code>carat</code> variable can no longer be shared between the two data frames, and a copy must be made. The size of each data frame is unchanged, but the collective size increases:</p>
<div class="sourceCode" id="cb444"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">diamonds</span><span class="op">$</span><span class="va">carat</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="fu">pryr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pryr/man/object_size.html">object_size</a></span><span class="op">(</span><span class="va">diamonds</span><span class="op">)</span>
<span class="co">#&gt; 3.46 MB</span>
<span class="fu">pryr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pryr/man/object_size.html">object_size</a></span><span class="op">(</span><span class="va">diamonds2</span><span class="op">)</span>
<span class="co">#&gt; 3.89 MB</span>
<span class="fu">pryr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/pryr/man/object_size.html">object_size</a></span><span class="op">(</span><span class="va">diamonds</span>, <span class="va">diamonds2</span><span class="op">)</span>
<span class="co">#&gt; 4.32 MB</span></code></pre></div>
<p>(Note that we use <code><a href="https://rdrr.io/pkg/pryr/man/object_size.html">pryr::object_size()</a></code> here, not the built-in <code><a href="https://rdrr.io/r/utils/object.size.html">object.size()</a></code>. <code><a href="https://rdrr.io/r/utils/object.size.html">object.size()</a></code> only takes a single object so it can’t compute how data is shared across multiple objects.)</p>
</div>
<div id="overwrite-the-original" class="section level3" number="18.2.2">
<h3>
<span class="header-section-number">18.2.2</span> Overwrite the original<a class="anchor" aria-label="anchor" href="#overwrite-the-original"><i class="fas fa-link"></i></a>
</h3>
<p>Instead of creating intermediate objects at each step, we could overwrite the original object:</p>
<div class="sourceCode" id="cb445"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">foo_foo</span> <span class="op">&lt;-</span> <span class="fu">hop</span><span class="op">(</span><span class="va">foo_foo</span>, through <span class="op">=</span> <span class="va">forest</span><span class="op">)</span>
<span class="va">foo_foo</span> <span class="op">&lt;-</span> <span class="fu">scoop</span><span class="op">(</span><span class="va">foo_foo</span>, up <span class="op">=</span> <span class="va">field_mice</span><span class="op">)</span>
<span class="va">foo_foo</span> <span class="op">&lt;-</span> <span class="fu">bop</span><span class="op">(</span><span class="va">foo_foo</span>, on <span class="op">=</span> <span class="va">head</span><span class="op">)</span></code></pre></div>
<p>This is less typing (and less thinking), so you’re less likely to make mistakes. However, there are two problems:</p>
<ol style="list-style-type: decimal">
<li><p>Debugging is painful: if you make a mistake you’ll need to re-run the
complete pipeline from the beginning.</p></li>
<li><p>The repetition of the object being transformed (we’ve written <code>foo_foo</code> six
times!) obscures what’s changing on each line.</p></li>
</ol>
</div>
<div id="function-composition" class="section level3" number="18.2.3">
<h3>
<span class="header-section-number">18.2.3</span> Function composition<a class="anchor" aria-label="anchor" href="#function-composition"><i class="fas fa-link"></i></a>
</h3>
<p>Another approach is to abandon assignment and just string the function calls together:</p>
<div class="sourceCode" id="cb446"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">bop</span><span class="op">(</span>
  <span class="fu">scoop</span><span class="op">(</span>
    <span class="fu">hop</span><span class="op">(</span><span class="va">foo_foo</span>, through <span class="op">=</span> <span class="va">forest</span><span class="op">)</span>,
    up <span class="op">=</span> <span class="va">field_mice</span>
  <span class="op">)</span>, 
  on <span class="op">=</span> <span class="va">head</span>
<span class="op">)</span></code></pre></div>
<p>Here the disadvantage is that you have to read from inside-out, from right-to-left, and that the arguments end up spread far apart (evocatively called the
<a href="https://en.wikipedia.org/wiki/Dagwood_sandwich">Dagwood sandwich</a> problem). In short, this code is hard for a human to consume.</p>
</div>
<div id="use-the-pipe" class="section level3" number="18.2.4">
<h3>
<span class="header-section-number">18.2.4</span> Use the pipe<a class="anchor" aria-label="anchor" href="#use-the-pipe"><i class="fas fa-link"></i></a>
</h3>
<p>Finally, we can use the pipe:</p>
<div class="sourceCode" id="cb447"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">foo_foo</span> <span class="op">%&gt;%</span>
  <span class="fu">hop</span><span class="op">(</span>through <span class="op">=</span> <span class="va">forest</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">scoop</span><span class="op">(</span>up <span class="op">=</span> <span class="va">field_mice</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">bop</span><span class="op">(</span>on <span class="op">=</span> <span class="va">head</span><span class="op">)</span></code></pre></div>
<p>This is my favourite form, because it focusses on verbs, not nouns. You can read this series of function compositions like it’s a set of imperative actions. Foo Foo hops, then scoops, then bops. The downside, of course, is that you need to be familiar with the pipe. If you’ve never seen <code><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></code> before, you’ll have no idea what this code does. Fortunately, most people pick up the idea very quickly, so when you share your code with others who aren’t familiar with the pipe, you can easily teach them.</p>
<p>The pipe works by performing a “lexical transformation”: behind the scenes, magrittr reassembles the code in the pipe to a form that works by overwriting an intermediate object. When you run a pipe like the one above, magrittr does something like this:</p>
<div class="sourceCode" id="cb448"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">my_pipe</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">.</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">.</span> <span class="op">&lt;-</span> <span class="fu">hop</span><span class="op">(</span><span class="va">.</span>, through <span class="op">=</span> <span class="va">forest</span><span class="op">)</span>
  <span class="va">.</span> <span class="op">&lt;-</span> <span class="fu">scoop</span><span class="op">(</span><span class="va">.</span>, up <span class="op">=</span> <span class="va">field_mice</span><span class="op">)</span>
  <span class="fu">bop</span><span class="op">(</span><span class="va">.</span>, on <span class="op">=</span> <span class="va">head</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu">my_pipe</span><span class="op">(</span><span class="va">foo_foo</span><span class="op">)</span></code></pre></div>
<p>This means that the pipe won’t work for two classes of functions:</p>
<ol style="list-style-type: decimal">
<li>
<p>Functions that use the current environment. For example, <code><a href="https://rdrr.io/r/base/assign.html">assign()</a></code>
will create a new variable with the given name in the current environment:</p>
<div class="sourceCode" id="cb449"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="fl">10</span><span class="op">)</span>
<span class="va">x</span>
<span class="co">#&gt; [1] 10</span>

<span class="st">"x"</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span>
<span class="va">x</span>
<span class="co">#&gt; [1] 10</span></code></pre></div>
<p>The use of assign with the pipe does not work because it assigns it to
a temporary environment used by <code><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></code>. If you do want to use assign with the
pipe, you must be explicit about the environment:</p>
<div class="sourceCode" id="cb450"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/environment.html">environment</a></span><span class="op">(</span><span class="op">)</span>
<span class="st">"x"</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/assign.html">assign</a></span><span class="op">(</span><span class="fl">100</span>, envir <span class="op">=</span> <span class="va">env</span><span class="op">)</span>
<span class="va">x</span>
<span class="co">#&gt; [1] 100</span></code></pre></div>
<p>Other functions with this problem include <code><a href="https://rdrr.io/r/base/get.html">get()</a></code> and <code><a href="https://rdrr.io/r/base/load.html">load()</a></code>.</p>
</li>
<li>
<p>Functions that use lazy evaluation. In R, function arguments
are only computed when the function uses them, not prior to calling the
function. The pipe computes each element in turn, so you can’t
rely on this behaviour.</p>
<p>One place that this is a problem is <code><a href="https://rdrr.io/r/base/conditions.html">tryCatch()</a></code>, which lets you capture
and handle errors:</p>
<div class="sourceCode" id="cb451"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"!"</span><span class="op">)</span>, error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="st">"An error"</span><span class="op">)</span>
<span class="co">#&gt; [1] "An error"</span>

<span class="kw"><a href="https://rdrr.io/r/base/stop.html">stop</a></span><span class="op">(</span><span class="st">"!"</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="kw"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span><span class="op">(</span>error <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">e</span><span class="op">)</span> <span class="st">"An error"</span><span class="op">)</span>
<span class="co">#&gt; [1] "An error"</span></code></pre></div>
<p>There are a relatively wide class of functions with this behaviour,
including <code><a href="https://rdrr.io/r/base/try.html">try()</a></code>, <code><a href="https://rdrr.io/r/base/message.html">suppressMessages()</a></code>, and <code><a href="https://rdrr.io/r/base/warning.html">suppressWarnings()</a></code>
in base R.</p>
</li>
</ol>
</div>
</div>
<div id="when-not-to-use-the-pipe" class="section level2" number="18.3">
<h2>
<span class="header-section-number">18.3</span> When not to use the pipe<a class="anchor" aria-label="anchor" href="#when-not-to-use-the-pipe"><i class="fas fa-link"></i></a>
</h2>
<p>The pipe is a powerful tool, but it’s not the only tool at your disposal, and it doesn’t solve every problem! Pipes are most useful for rewriting a fairly short linear sequence of operations. I think you should reach for another tool when:</p>
<ul>
<li><p>Your pipes are longer than (say) ten steps. In that case, create
intermediate objects with meaningful names. That will make debugging easier,
because you can more easily check the intermediate results, and it makes
it easier to understand your code, because the variable names can help
communicate intent.</p></li>
<li><p>You have multiple inputs or outputs. If there isn’t one primary object
being transformed, but two or more objects being combined together,
don’t use the pipe.</p></li>
<li><p>You are starting to think about a directed graph with a complex
dependency structure. Pipes are fundamentally linear and expressing
complex relationships with them will typically yield confusing code.</p></li>
</ul>
</div>
<div id="other-tools-from-magrittr" class="section level2" number="18.4">
<h2>
<span class="header-section-number">18.4</span> Other tools from magrittr<a class="anchor" aria-label="anchor" href="#other-tools-from-magrittr"><i class="fas fa-link"></i></a>
</h2>
<p>All packages in the tidyverse automatically make <code><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></code> available for you, so you don’t normally load magrittr explicitly. However, there are some other useful tools inside magrittr that you might want to try out:</p>
<ul>
<li>
<p>When working with more complex pipes, it’s sometimes useful to call a
function for its side-effects. Maybe you want to print out the current
object, or plot it, or save it to disk. Many times, such functions don’t
return anything, effectively terminating the pipe.</p>
<p>To work around this problem, you can use the “tee” pipe. <code><a href="https://magrittr.tidyverse.org/reference/tee.html">%T&gt;%</a></code> works like
<code><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></code> except that it returns the left-hand side instead of the right-hand
side. It’s called “tee” because it’s like a literal T-shaped pipe.</p>
<div class="sourceCode" id="cb452"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt;  NULL</span>

<span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">100</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">%T&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html">plot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://rdrr.io/r/utils/str.html">str</a></span><span class="op">(</span><span class="op">)</span>
<span class="co">#&gt;  num [1:50, 1:2] -0.387 -0.785 -1.057 -0.796 -1.756 ...</span></code></pre></div>
<p><img src="pipes_files/figure-html/unnamed-chunk-12-1.png" width="70%" style="display: block; margin: auto;"><img src="pipes_files/figure-html/unnamed-chunk-12-2.png" width="70%" style="display: block; margin: auto;"></p>
</li>
<li>
<p>If you’re working with functions that don’t have a data frame based API<br>
(i.e. you pass them individual vectors, not a data frame and expressions
to be evaluated in the context of that data frame), you might find <code><a href="https://magrittr.tidyverse.org/reference/exposition.html">%$%</a></code>
useful. It “explodes” out the variables in a data frame so that you can
refer to them explicitly. This is useful when working with many functions
in base R:</p>
<div class="sourceCode" id="cb453"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mtcars</span> <span class="op">%$%</span>
  <span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">disp</span>, <span class="va">mpg</span><span class="op">)</span>
<span class="co">#&gt; [1] -0.8475514</span></code></pre></div>
</li>
<li>
<p>For assignment magrittr provides the <code><a href="https://magrittr.tidyverse.org/reference/compound.html">%&lt;&gt;%</a></code> operator which allows you to
replace code like:</p>
<div class="sourceCode" id="cb454"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mtcars</span> <span class="op">&lt;-</span> <span class="va">mtcars</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/r/base/transform.html">transform</a></span><span class="op">(</span>cyl <span class="op">=</span> <span class="va">cyl</span> <span class="op">*</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p>with</p>
<div class="sourceCode" id="cb455"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mtcars</span> <span class="op">%&lt;&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html">transform</a></span><span class="op">(</span>cyl <span class="op">=</span> <span class="va">cyl</span> <span class="op">*</span> <span class="fl">2</span><span class="op">)</span></code></pre></div>
<p>I’m not a fan of this operator because I think assignment is such a
special operation that it should always be clear when it’s occurring.
In my opinion, a little bit of duplication (i.e. repeating the
name of the object twice) is fine in return for making assignment
more explicit.</p>
</li>
</ul>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="program-intro.html"><span class="header-section-number">17</span> Introduction</a></div>
<div class="next"><a href="functions.html"><span class="header-section-number">19</span> Functions</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#pipes"><span class="header-section-number">18</span> Pipes</a></li>
<li>
<a class="nav-link" href="#introduction-11"><span class="header-section-number">18.1</span> Introduction</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#prerequisites-11"><span class="header-section-number">18.1.1</span> Prerequisites</a></li></ul>
</li>
<li>
<a class="nav-link" href="#piping-alternatives"><span class="header-section-number">18.2</span> Piping alternatives</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#intermediate-steps"><span class="header-section-number">18.2.1</span> Intermediate steps</a></li>
<li><a class="nav-link" href="#overwrite-the-original"><span class="header-section-number">18.2.2</span> Overwrite the original</a></li>
<li><a class="nav-link" href="#function-composition"><span class="header-section-number">18.2.3</span> Function composition</a></li>
<li><a class="nav-link" href="#use-the-pipe"><span class="header-section-number">18.2.4</span> Use the pipe</a></li>
</ul>
</li>
<li><a class="nav-link" href="#when-not-to-use-the-pipe"><span class="header-section-number">18.3</span> When not to use the pipe</a></li>
<li><a class="nav-link" href="#other-tools-from-magrittr"><span class="header-section-number">18.4</span> Other tools from magrittr</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/hadley/r4ds/blob/master/pipes.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/hadley/r4ds/edit/master/pipes.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>R for Data Science (2e)</strong>" was written by Hadley Wickham and Garrett Grolemund. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
