<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>25 Many models | R for Data Science (2e)</title>
  <meta name="description" content="This book will teach you how to do data science with R: You’ll learn how to get your data into R, get it into the most useful structure, transform it, visualise it and model it. In this book, you will find a practicum of skills for data science. Just as a chemist learns how to clean test tubes and stock a lab, you’ll learn how to clean data and draw plots—and many other things besides. These are the skills that allow data science to happen, and here you will find the best practices for doing each of these things with R. You’ll learn how to use the grammar of graphics, literate programming, and reproducible research to save time. You’ll also learn how to manage cognitive resources to facilitate discoveries when wrangling, visualising, and exploring data." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="25 Many models | R for Data Science (2e)" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="https://r4ds.had.co.nz/" />
  <meta property="og:image" content="https://r4ds.had.co.nz/cover.png" />
  <meta property="og:description" content="This book will teach you how to do data science with R: You’ll learn how to get your data into R, get it into the most useful structure, transform it, visualise it and model it. In this book, you will find a practicum of skills for data science. Just as a chemist learns how to clean test tubes and stock a lab, you’ll learn how to clean data and draw plots—and many other things besides. These are the skills that allow data science to happen, and here you will find the best practices for doing each of these things with R. You’ll learn how to use the grammar of graphics, literate programming, and reproducible research to save time. You’ll also learn how to manage cognitive resources to facilitate discoveries when wrangling, visualising, and exploring data." />
  <meta name="github-repo" content="hadley/r4ds" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="25 Many models | R for Data Science (2e)" />
  <meta name="twitter:site" content="@hadley" />
  <meta name="twitter:description" content="This book will teach you how to do data science with R: You’ll learn how to get your data into R, get it into the most useful structure, transform it, visualise it and model it. In this book, you will find a practicum of skills for data science. Just as a chemist learns how to clean test tubes and stock a lab, you’ll learn how to clean data and draw plots—and many other things besides. These are the skills that allow data science to happen, and here you will find the best practices for doing each of these things with R. You’ll learn how to use the grammar of graphics, literate programming, and reproducible research to save time. You’ll also learn how to manage cognitive resources to facilitate discoveries when wrangling, visualising, and exploring data." />
  <meta name="twitter:image" content="https://r4ds.had.co.nz/cover.png" />

<meta name="author" content="Hadley Wickham and Garrett Grolemund" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="model-building.html"/>
<link rel="next" href="communicate-intro.html"/>
<script src="libs/header-attrs-2.6/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet" />
<script src="libs/str_view-binding-1.4.0/str_view.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.0.4.1/leaflet.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="r4ds.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">R for Data Science</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#acknowledgements"><i class="fa fa-check"></i>Acknowledgements</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="introduction.html"><a href="introduction.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="introduction.html"><a href="introduction.html#what-you-will-learn"><i class="fa fa-check"></i><b>1.1</b> What you will learn</a></li>
<li class="chapter" data-level="1.2" data-path="introduction.html"><a href="introduction.html#how-this-book-is-organised"><i class="fa fa-check"></i><b>1.2</b> How this book is organised</a></li>
<li class="chapter" data-level="1.3" data-path="introduction.html"><a href="introduction.html#what-you-wont-learn"><i class="fa fa-check"></i><b>1.3</b> What you won’t learn</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="introduction.html"><a href="introduction.html#big-data"><i class="fa fa-check"></i><b>1.3.1</b> Big data</a></li>
<li class="chapter" data-level="1.3.2" data-path="introduction.html"><a href="introduction.html#python-julia-and-friends"><i class="fa fa-check"></i><b>1.3.2</b> Python, Julia, and friends</a></li>
<li class="chapter" data-level="1.3.3" data-path="introduction.html"><a href="introduction.html#non-rectangular-data"><i class="fa fa-check"></i><b>1.3.3</b> Non-rectangular data</a></li>
<li class="chapter" data-level="1.3.4" data-path="introduction.html"><a href="introduction.html#hypothesis-confirmation"><i class="fa fa-check"></i><b>1.3.4</b> Hypothesis confirmation</a></li>
</ul></li>
<li class="chapter" data-level="1.4" data-path="introduction.html"><a href="introduction.html#prerequisites"><i class="fa fa-check"></i><b>1.4</b> Prerequisites</a>
<ul>
<li class="chapter" data-level="1.4.1" data-path="introduction.html"><a href="introduction.html#r"><i class="fa fa-check"></i><b>1.4.1</b> R</a></li>
<li class="chapter" data-level="1.4.2" data-path="introduction.html"><a href="introduction.html#rstudio"><i class="fa fa-check"></i><b>1.4.2</b> RStudio</a></li>
<li class="chapter" data-level="1.4.3" data-path="introduction.html"><a href="introduction.html#the-tidyverse"><i class="fa fa-check"></i><b>1.4.3</b> The tidyverse</a></li>
<li class="chapter" data-level="1.4.4" data-path="introduction.html"><a href="introduction.html#other-packages"><i class="fa fa-check"></i><b>1.4.4</b> Other packages</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="introduction.html"><a href="introduction.html#running-r-code"><i class="fa fa-check"></i><b>1.5</b> Running R code</a></li>
<li class="chapter" data-level="1.6" data-path="introduction.html"><a href="introduction.html#getting-help-and-learning-more"><i class="fa fa-check"></i><b>1.6</b> Getting help and learning more</a></li>
<li class="chapter" data-level="1.7" data-path="introduction.html"><a href="introduction.html#acknowledgements-1"><i class="fa fa-check"></i><b>1.7</b> Acknowledgements</a></li>
<li class="chapter" data-level="1.8" data-path="introduction.html"><a href="introduction.html#colophon"><i class="fa fa-check"></i><b>1.8</b> Colophon</a></li>
</ul></li>
<li class="part"><span><b>I Explore</b></span></li>
<li class="chapter" data-level="2" data-path="explore-intro.html"><a href="explore-intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="data-visualisation.html"><a href="data-visualisation.html"><i class="fa fa-check"></i><b>3</b> Data visualisation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="data-visualisation.html"><a href="data-visualisation.html#introduction-1"><i class="fa fa-check"></i><b>3.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="data-visualisation.html"><a href="data-visualisation.html#prerequisites-1"><i class="fa fa-check"></i><b>3.1.1</b> Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="data-visualisation.html"><a href="data-visualisation.html#first-steps"><i class="fa fa-check"></i><b>3.2</b> First steps</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="data-visualisation.html"><a href="data-visualisation.html#the-mpg-data-frame"><i class="fa fa-check"></i><b>3.2.1</b> The <code>mpg</code> data frame</a></li>
<li class="chapter" data-level="3.2.2" data-path="data-visualisation.html"><a href="data-visualisation.html#creating-a-ggplot"><i class="fa fa-check"></i><b>3.2.2</b> Creating a ggplot</a></li>
<li class="chapter" data-level="3.2.3" data-path="data-visualisation.html"><a href="data-visualisation.html#a-graphing-template"><i class="fa fa-check"></i><b>3.2.3</b> A graphing template</a></li>
<li class="chapter" data-level="3.2.4" data-path="data-visualisation.html"><a href="data-visualisation.html#exercises"><i class="fa fa-check"></i><b>3.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="data-visualisation.html"><a href="data-visualisation.html#aesthetic-mappings"><i class="fa fa-check"></i><b>3.3</b> Aesthetic mappings</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="data-visualisation.html"><a href="data-visualisation.html#exercises-1"><i class="fa fa-check"></i><b>3.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="data-visualisation.html"><a href="data-visualisation.html#common-problems"><i class="fa fa-check"></i><b>3.4</b> Common problems</a></li>
<li class="chapter" data-level="3.5" data-path="data-visualisation.html"><a href="data-visualisation.html#facets"><i class="fa fa-check"></i><b>3.5</b> Facets</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="data-visualisation.html"><a href="data-visualisation.html#exercises-2"><i class="fa fa-check"></i><b>3.5.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="data-visualisation.html"><a href="data-visualisation.html#geometric-objects"><i class="fa fa-check"></i><b>3.6</b> Geometric objects</a>
<ul>
<li class="chapter" data-level="3.6.1" data-path="data-visualisation.html"><a href="data-visualisation.html#exercises-3"><i class="fa fa-check"></i><b>3.6.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="data-visualisation.html"><a href="data-visualisation.html#statistical-transformations"><i class="fa fa-check"></i><b>3.7</b> Statistical transformations</a>
<ul>
<li class="chapter" data-level="3.7.1" data-path="data-visualisation.html"><a href="data-visualisation.html#exercises-4"><i class="fa fa-check"></i><b>3.7.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="data-visualisation.html"><a href="data-visualisation.html#position-adjustments"><i class="fa fa-check"></i><b>3.8</b> Position adjustments</a>
<ul>
<li class="chapter" data-level="3.8.1" data-path="data-visualisation.html"><a href="data-visualisation.html#exercises-5"><i class="fa fa-check"></i><b>3.8.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="data-visualisation.html"><a href="data-visualisation.html#coordinate-systems"><i class="fa fa-check"></i><b>3.9</b> Coordinate systems</a>
<ul>
<li class="chapter" data-level="3.9.1" data-path="data-visualisation.html"><a href="data-visualisation.html#exercises-6"><i class="fa fa-check"></i><b>3.9.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="3.10" data-path="data-visualisation.html"><a href="data-visualisation.html#the-layered-grammar-of-graphics"><i class="fa fa-check"></i><b>3.10</b> The layered grammar of graphics</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="workflow-basics.html"><a href="workflow-basics.html"><i class="fa fa-check"></i><b>4</b> Workflow: basics</a>
<ul>
<li class="chapter" data-level="4.1" data-path="workflow-basics.html"><a href="workflow-basics.html#coding-basics"><i class="fa fa-check"></i><b>4.1</b> Coding basics</a></li>
<li class="chapter" data-level="4.2" data-path="workflow-basics.html"><a href="workflow-basics.html#whats-in-a-name"><i class="fa fa-check"></i><b>4.2</b> What’s in a name?</a></li>
<li class="chapter" data-level="4.3" data-path="workflow-basics.html"><a href="workflow-basics.html#calling-functions"><i class="fa fa-check"></i><b>4.3</b> Calling functions</a></li>
<li class="chapter" data-level="4.4" data-path="workflow-basics.html"><a href="workflow-basics.html#exercises-7"><i class="fa fa-check"></i><b>4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="transform.html"><a href="transform.html"><i class="fa fa-check"></i><b>5</b> Data transformation</a>
<ul>
<li class="chapter" data-level="5.1" data-path="transform.html"><a href="transform.html#introduction-2"><i class="fa fa-check"></i><b>5.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="transform.html"><a href="transform.html#prerequisites-2"><i class="fa fa-check"></i><b>5.1.1</b> Prerequisites</a></li>
<li class="chapter" data-level="5.1.2" data-path="transform.html"><a href="transform.html#nycflights13"><i class="fa fa-check"></i><b>5.1.2</b> nycflights13</a></li>
<li class="chapter" data-level="5.1.3" data-path="transform.html"><a href="transform.html#dplyr-basics"><i class="fa fa-check"></i><b>5.1.3</b> dplyr basics</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="transform.html"><a href="transform.html#filter-rows-with-filter"><i class="fa fa-check"></i><b>5.2</b> Filter rows with <code>filter()</code></a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="transform.html"><a href="transform.html#comparisons"><i class="fa fa-check"></i><b>5.2.1</b> Comparisons</a></li>
<li class="chapter" data-level="5.2.2" data-path="transform.html"><a href="transform.html#logical-operators"><i class="fa fa-check"></i><b>5.2.2</b> Logical operators</a></li>
<li class="chapter" data-level="5.2.3" data-path="transform.html"><a href="transform.html#missing-values"><i class="fa fa-check"></i><b>5.2.3</b> Missing values</a></li>
<li class="chapter" data-level="5.2.4" data-path="transform.html"><a href="transform.html#exercises-8"><i class="fa fa-check"></i><b>5.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="transform.html"><a href="transform.html#arrange-rows-with-arrange"><i class="fa fa-check"></i><b>5.3</b> Arrange rows with <code>arrange()</code></a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="transform.html"><a href="transform.html#exercises-9"><i class="fa fa-check"></i><b>5.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="transform.html"><a href="transform.html#select"><i class="fa fa-check"></i><b>5.4</b> Select columns with <code>select()</code></a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="transform.html"><a href="transform.html#exercises-10"><i class="fa fa-check"></i><b>5.4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="transform.html"><a href="transform.html#add-new-variables-with-mutate"><i class="fa fa-check"></i><b>5.5</b> Add new variables with <code>mutate()</code></a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="transform.html"><a href="transform.html#mutate-funs"><i class="fa fa-check"></i><b>5.5.1</b> Useful creation functions</a></li>
<li class="chapter" data-level="5.5.2" data-path="transform.html"><a href="transform.html#exercises-11"><i class="fa fa-check"></i><b>5.5.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="transform.html"><a href="transform.html#grouped-summaries-with-summarise"><i class="fa fa-check"></i><b>5.6</b> Grouped summaries with <code>summarise()</code></a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="transform.html"><a href="transform.html#combining-multiple-operations-with-the-pipe"><i class="fa fa-check"></i><b>5.6.1</b> Combining multiple operations with the pipe</a></li>
<li class="chapter" data-level="5.6.2" data-path="transform.html"><a href="transform.html#missing-values-1"><i class="fa fa-check"></i><b>5.6.2</b> Missing values</a></li>
<li class="chapter" data-level="5.6.3" data-path="transform.html"><a href="transform.html#counts"><i class="fa fa-check"></i><b>5.6.3</b> Counts</a></li>
<li class="chapter" data-level="5.6.4" data-path="transform.html"><a href="transform.html#summarise-funs"><i class="fa fa-check"></i><b>5.6.4</b> Useful summary functions</a></li>
<li class="chapter" data-level="5.6.5" data-path="transform.html"><a href="transform.html#grouping-by-multiple-variables"><i class="fa fa-check"></i><b>5.6.5</b> Grouping by multiple variables</a></li>
<li class="chapter" data-level="5.6.6" data-path="transform.html"><a href="transform.html#ungrouping"><i class="fa fa-check"></i><b>5.6.6</b> Ungrouping</a></li>
<li class="chapter" data-level="5.6.7" data-path="transform.html"><a href="transform.html#exercises-12"><i class="fa fa-check"></i><b>5.6.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="transform.html"><a href="transform.html#grouped-mutates-and-filters"><i class="fa fa-check"></i><b>5.7</b> Grouped mutates (and filters)</a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="transform.html"><a href="transform.html#exercises-13"><i class="fa fa-check"></i><b>5.7.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="workflow-scripts.html"><a href="workflow-scripts.html"><i class="fa fa-check"></i><b>6</b> Workflow: scripts</a>
<ul>
<li class="chapter" data-level="6.1" data-path="workflow-scripts.html"><a href="workflow-scripts.html#running-code"><i class="fa fa-check"></i><b>6.1</b> Running code</a></li>
<li class="chapter" data-level="6.2" data-path="workflow-scripts.html"><a href="workflow-scripts.html#rstudio-diagnostics"><i class="fa fa-check"></i><b>6.2</b> RStudio diagnostics</a></li>
<li class="chapter" data-level="6.3" data-path="workflow-scripts.html"><a href="workflow-scripts.html#exercises-14"><i class="fa fa-check"></i><b>6.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html"><i class="fa fa-check"></i><b>7</b> Exploratory Data Analysis</a>
<ul>
<li class="chapter" data-level="7.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#introduction-3"><i class="fa fa-check"></i><b>7.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#prerequisites-3"><i class="fa fa-check"></i><b>7.1.1</b> Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#questions"><i class="fa fa-check"></i><b>7.2</b> Questions</a></li>
<li class="chapter" data-level="7.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#variation"><i class="fa fa-check"></i><b>7.3</b> Variation</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#visualising-distributions"><i class="fa fa-check"></i><b>7.3.1</b> Visualising distributions</a></li>
<li class="chapter" data-level="7.3.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#typical-values"><i class="fa fa-check"></i><b>7.3.2</b> Typical values</a></li>
<li class="chapter" data-level="7.3.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#unusual-values"><i class="fa fa-check"></i><b>7.3.3</b> Unusual values</a></li>
<li class="chapter" data-level="7.3.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#exercises-15"><i class="fa fa-check"></i><b>7.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#missing-values-2"><i class="fa fa-check"></i><b>7.4</b> Missing values</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#exercises-16"><i class="fa fa-check"></i><b>7.4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#covariation"><i class="fa fa-check"></i><b>7.5</b> Covariation</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#cat-cont"><i class="fa fa-check"></i><b>7.5.1</b> A categorical and continuous variable</a></li>
<li class="chapter" data-level="7.5.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#two-categorical-variables"><i class="fa fa-check"></i><b>7.5.2</b> Two categorical variables</a></li>
<li class="chapter" data-level="7.5.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#two-continuous-variables"><i class="fa fa-check"></i><b>7.5.3</b> Two continuous variables</a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#patterns-and-models"><i class="fa fa-check"></i><b>7.6</b> Patterns and models</a></li>
<li class="chapter" data-level="7.7" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#ggplot2-calls"><i class="fa fa-check"></i><b>7.7</b> ggplot2 calls</a></li>
<li class="chapter" data-level="7.8" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#learning-more"><i class="fa fa-check"></i><b>7.8</b> Learning more</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="workflow-projects.html"><a href="workflow-projects.html"><i class="fa fa-check"></i><b>8</b> Workflow: projects</a>
<ul>
<li class="chapter" data-level="8.1" data-path="workflow-projects.html"><a href="workflow-projects.html#what-is-real"><i class="fa fa-check"></i><b>8.1</b> What is real?</a></li>
<li class="chapter" data-level="8.2" data-path="workflow-projects.html"><a href="workflow-projects.html#where-does-your-analysis-live"><i class="fa fa-check"></i><b>8.2</b> Where does your analysis live?</a></li>
<li class="chapter" data-level="8.3" data-path="workflow-projects.html"><a href="workflow-projects.html#paths-and-directories"><i class="fa fa-check"></i><b>8.3</b> Paths and directories</a></li>
<li class="chapter" data-level="8.4" data-path="workflow-projects.html"><a href="workflow-projects.html#rstudio-projects"><i class="fa fa-check"></i><b>8.4</b> RStudio projects</a></li>
<li class="chapter" data-level="8.5" data-path="workflow-projects.html"><a href="workflow-projects.html#summary"><i class="fa fa-check"></i><b>8.5</b> Summary</a></li>
</ul></li>
<li class="part"><span><b>II Wrangle</b></span></li>
<li class="chapter" data-level="9" data-path="wrangle-intro.html"><a href="wrangle-intro.html"><i class="fa fa-check"></i><b>9</b> Introduction</a></li>
<li class="chapter" data-level="10" data-path="tibbles.html"><a href="tibbles.html"><i class="fa fa-check"></i><b>10</b> Tibbles</a>
<ul>
<li class="chapter" data-level="10.1" data-path="tibbles.html"><a href="tibbles.html#introduction-4"><i class="fa fa-check"></i><b>10.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="10.1.1" data-path="tibbles.html"><a href="tibbles.html#prerequisites-4"><i class="fa fa-check"></i><b>10.1.1</b> Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="10.2" data-path="tibbles.html"><a href="tibbles.html#creating-tibbles"><i class="fa fa-check"></i><b>10.2</b> Creating tibbles</a></li>
<li class="chapter" data-level="10.3" data-path="tibbles.html"><a href="tibbles.html#tibbles-vs.-data.frame"><i class="fa fa-check"></i><b>10.3</b> Tibbles vs. data.frame</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="tibbles.html"><a href="tibbles.html#printing"><i class="fa fa-check"></i><b>10.3.1</b> Printing</a></li>
<li class="chapter" data-level="10.3.2" data-path="tibbles.html"><a href="tibbles.html#subsetting"><i class="fa fa-check"></i><b>10.3.2</b> Subsetting</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="tibbles.html"><a href="tibbles.html#interacting-with-older-code"><i class="fa fa-check"></i><b>10.4</b> Interacting with older code</a></li>
<li class="chapter" data-level="10.5" data-path="tibbles.html"><a href="tibbles.html#exercises-20"><i class="fa fa-check"></i><b>10.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="data-import.html"><a href="data-import.html"><i class="fa fa-check"></i><b>11</b> Data import</a>
<ul>
<li class="chapter" data-level="11.1" data-path="data-import.html"><a href="data-import.html#introduction-5"><i class="fa fa-check"></i><b>11.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="data-import.html"><a href="data-import.html#prerequisites-5"><i class="fa fa-check"></i><b>11.1.1</b> Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="data-import.html"><a href="data-import.html#getting-started"><i class="fa fa-check"></i><b>11.2</b> Getting started</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="data-import.html"><a href="data-import.html#compared-to-base-r"><i class="fa fa-check"></i><b>11.2.1</b> Compared to base R</a></li>
<li class="chapter" data-level="11.2.2" data-path="data-import.html"><a href="data-import.html#exercises-21"><i class="fa fa-check"></i><b>11.2.2</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11.3" data-path="data-import.html"><a href="data-import.html#parsing-a-vector"><i class="fa fa-check"></i><b>11.3</b> Parsing a vector</a>
<ul>
<li class="chapter" data-level="11.3.1" data-path="data-import.html"><a href="data-import.html#numbers"><i class="fa fa-check"></i><b>11.3.1</b> Numbers</a></li>
<li class="chapter" data-level="11.3.2" data-path="data-import.html"><a href="data-import.html#readr-strings"><i class="fa fa-check"></i><b>11.3.2</b> Strings</a></li>
<li class="chapter" data-level="11.3.3" data-path="data-import.html"><a href="data-import.html#readr-factors"><i class="fa fa-check"></i><b>11.3.3</b> Factors</a></li>
<li class="chapter" data-level="11.3.4" data-path="data-import.html"><a href="data-import.html#readr-datetimes"><i class="fa fa-check"></i><b>11.3.4</b> Dates, date-times, and times</a></li>
<li class="chapter" data-level="11.3.5" data-path="data-import.html"><a href="data-import.html#exercises-22"><i class="fa fa-check"></i><b>11.3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="data-import.html"><a href="data-import.html#parsing-a-file"><i class="fa fa-check"></i><b>11.4</b> Parsing a file</a>
<ul>
<li class="chapter" data-level="11.4.1" data-path="data-import.html"><a href="data-import.html#strategy"><i class="fa fa-check"></i><b>11.4.1</b> Strategy</a></li>
<li class="chapter" data-level="11.4.2" data-path="data-import.html"><a href="data-import.html#problems"><i class="fa fa-check"></i><b>11.4.2</b> Problems</a></li>
<li class="chapter" data-level="11.4.3" data-path="data-import.html"><a href="data-import.html#other-strategies"><i class="fa fa-check"></i><b>11.4.3</b> Other strategies</a></li>
</ul></li>
<li class="chapter" data-level="11.5" data-path="data-import.html"><a href="data-import.html#writing-to-a-file"><i class="fa fa-check"></i><b>11.5</b> Writing to a file</a></li>
<li class="chapter" data-level="11.6" data-path="data-import.html"><a href="data-import.html#other-types-of-data"><i class="fa fa-check"></i><b>11.6</b> Other types of data</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="tidy-data.html"><a href="tidy-data.html"><i class="fa fa-check"></i><b>12</b> Tidy data</a>
<ul>
<li class="chapter" data-level="12.1" data-path="tidy-data.html"><a href="tidy-data.html#introduction-6"><i class="fa fa-check"></i><b>12.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="tidy-data.html"><a href="tidy-data.html#prerequisites-6"><i class="fa fa-check"></i><b>12.1.1</b> Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="tidy-data.html"><a href="tidy-data.html#tidy-data-1"><i class="fa fa-check"></i><b>12.2</b> Tidy data</a>
<ul>
<li class="chapter" data-level="12.2.1" data-path="tidy-data.html"><a href="tidy-data.html#exercises-23"><i class="fa fa-check"></i><b>12.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="tidy-data.html"><a href="tidy-data.html#pivoting"><i class="fa fa-check"></i><b>12.3</b> Pivoting</a>
<ul>
<li class="chapter" data-level="12.3.1" data-path="tidy-data.html"><a href="tidy-data.html#longer"><i class="fa fa-check"></i><b>12.3.1</b> Longer</a></li>
<li class="chapter" data-level="12.3.2" data-path="tidy-data.html"><a href="tidy-data.html#wider"><i class="fa fa-check"></i><b>12.3.2</b> Wider</a></li>
<li class="chapter" data-level="12.3.3" data-path="tidy-data.html"><a href="tidy-data.html#exercises-24"><i class="fa fa-check"></i><b>12.3.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="12.4" data-path="tidy-data.html"><a href="tidy-data.html#separating"><i class="fa fa-check"></i><b>12.4</b> Separating</a>
<ul>
<li class="chapter" data-level="12.4.1" data-path="tidy-data.html"><a href="tidy-data.html#separate"><i class="fa fa-check"></i><b>12.4.1</b> Separate</a></li>
<li class="chapter" data-level="12.4.2" data-path="tidy-data.html"><a href="tidy-data.html#unite"><i class="fa fa-check"></i><b>12.4.2</b> Unite</a></li>
<li class="chapter" data-level="12.4.3" data-path="tidy-data.html"><a href="tidy-data.html#exercises-25"><i class="fa fa-check"></i><b>12.4.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="tidy-data.html"><a href="tidy-data.html#missing-values-3"><i class="fa fa-check"></i><b>12.5</b> Missing values</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="tidy-data.html"><a href="tidy-data.html#exercises-26"><i class="fa fa-check"></i><b>12.5.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="tidy-data.html"><a href="tidy-data.html#case-study"><i class="fa fa-check"></i><b>12.6</b> Case study</a>
<ul>
<li class="chapter" data-level="12.6.1" data-path="tidy-data.html"><a href="tidy-data.html#exercises-27"><i class="fa fa-check"></i><b>12.6.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="12.7" data-path="tidy-data.html"><a href="tidy-data.html#non-tidy-data"><i class="fa fa-check"></i><b>12.7</b> Non-tidy data</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="relational-data.html"><a href="relational-data.html"><i class="fa fa-check"></i><b>13</b> Relational data</a>
<ul>
<li class="chapter" data-level="13.1" data-path="relational-data.html"><a href="relational-data.html#introduction-7"><i class="fa fa-check"></i><b>13.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="relational-data.html"><a href="relational-data.html#prerequisites-7"><i class="fa fa-check"></i><b>13.1.1</b> Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="relational-data.html"><a href="relational-data.html#nycflights13-relational"><i class="fa fa-check"></i><b>13.2</b> nycflights13</a>
<ul>
<li class="chapter" data-level="13.2.1" data-path="relational-data.html"><a href="relational-data.html#exercises-28"><i class="fa fa-check"></i><b>13.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="relational-data.html"><a href="relational-data.html#keys"><i class="fa fa-check"></i><b>13.3</b> Keys</a>
<ul>
<li class="chapter" data-level="13.3.1" data-path="relational-data.html"><a href="relational-data.html#exercises-29"><i class="fa fa-check"></i><b>13.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.4" data-path="relational-data.html"><a href="relational-data.html#mutating-joins"><i class="fa fa-check"></i><b>13.4</b> Mutating joins</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="relational-data.html"><a href="relational-data.html#understanding-joins"><i class="fa fa-check"></i><b>13.4.1</b> Understanding joins</a></li>
<li class="chapter" data-level="13.4.2" data-path="relational-data.html"><a href="relational-data.html#inner-join"><i class="fa fa-check"></i><b>13.4.2</b> Inner join</a></li>
<li class="chapter" data-level="13.4.3" data-path="relational-data.html"><a href="relational-data.html#outer-join"><i class="fa fa-check"></i><b>13.4.3</b> Outer joins</a></li>
<li class="chapter" data-level="13.4.4" data-path="relational-data.html"><a href="relational-data.html#join-matches"><i class="fa fa-check"></i><b>13.4.4</b> Duplicate keys</a></li>
<li class="chapter" data-level="13.4.5" data-path="relational-data.html"><a href="relational-data.html#join-by"><i class="fa fa-check"></i><b>13.4.5</b> Defining the key columns</a></li>
<li class="chapter" data-level="13.4.6" data-path="relational-data.html"><a href="relational-data.html#exercises-30"><i class="fa fa-check"></i><b>13.4.6</b> Exercises</a></li>
<li class="chapter" data-level="13.4.7" data-path="relational-data.html"><a href="relational-data.html#other-implementations"><i class="fa fa-check"></i><b>13.4.7</b> Other implementations</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="relational-data.html"><a href="relational-data.html#filtering-joins"><i class="fa fa-check"></i><b>13.5</b> Filtering joins</a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="relational-data.html"><a href="relational-data.html#exercises-31"><i class="fa fa-check"></i><b>13.5.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="relational-data.html"><a href="relational-data.html#join-problems"><i class="fa fa-check"></i><b>13.6</b> Join problems</a></li>
<li class="chapter" data-level="13.7" data-path="relational-data.html"><a href="relational-data.html#set-operations"><i class="fa fa-check"></i><b>13.7</b> Set operations</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="strings.html"><a href="strings.html"><i class="fa fa-check"></i><b>14</b> Strings</a>
<ul>
<li class="chapter" data-level="14.1" data-path="strings.html"><a href="strings.html#introduction-8"><i class="fa fa-check"></i><b>14.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="14.1.1" data-path="strings.html"><a href="strings.html#prerequisites-8"><i class="fa fa-check"></i><b>14.1.1</b> Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="14.2" data-path="strings.html"><a href="strings.html#string-basics"><i class="fa fa-check"></i><b>14.2</b> String basics</a>
<ul>
<li class="chapter" data-level="14.2.1" data-path="strings.html"><a href="strings.html#string-length"><i class="fa fa-check"></i><b>14.2.1</b> String length</a></li>
<li class="chapter" data-level="14.2.2" data-path="strings.html"><a href="strings.html#combining-strings"><i class="fa fa-check"></i><b>14.2.2</b> Combining strings</a></li>
<li class="chapter" data-level="14.2.3" data-path="strings.html"><a href="strings.html#subsetting-strings"><i class="fa fa-check"></i><b>14.2.3</b> Subsetting strings</a></li>
<li class="chapter" data-level="14.2.4" data-path="strings.html"><a href="strings.html#locales"><i class="fa fa-check"></i><b>14.2.4</b> Locales</a></li>
<li class="chapter" data-level="14.2.5" data-path="strings.html"><a href="strings.html#exercises-32"><i class="fa fa-check"></i><b>14.2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14.3" data-path="strings.html"><a href="strings.html#matching-patterns-with-regular-expressions"><i class="fa fa-check"></i><b>14.3</b> Matching patterns with regular expressions</a>
<ul>
<li class="chapter" data-level="14.3.1" data-path="strings.html"><a href="strings.html#basic-matches"><i class="fa fa-check"></i><b>14.3.1</b> Basic matches</a></li>
<li class="chapter" data-level="14.3.2" data-path="strings.html"><a href="strings.html#anchors"><i class="fa fa-check"></i><b>14.3.2</b> Anchors</a></li>
<li class="chapter" data-level="14.3.3" data-path="strings.html"><a href="strings.html#character-classes-and-alternatives"><i class="fa fa-check"></i><b>14.3.3</b> Character classes and alternatives</a></li>
<li class="chapter" data-level="14.3.4" data-path="strings.html"><a href="strings.html#repetition"><i class="fa fa-check"></i><b>14.3.4</b> Repetition</a></li>
<li class="chapter" data-level="14.3.5" data-path="strings.html"><a href="strings.html#grouping-and-backreferences"><i class="fa fa-check"></i><b>14.3.5</b> Grouping and backreferences</a></li>
</ul></li>
<li class="chapter" data-level="14.4" data-path="strings.html"><a href="strings.html#tools"><i class="fa fa-check"></i><b>14.4</b> Tools</a>
<ul>
<li class="chapter" data-level="14.4.1" data-path="strings.html"><a href="strings.html#detect-matches"><i class="fa fa-check"></i><b>14.4.1</b> Detect matches</a></li>
<li class="chapter" data-level="14.4.2" data-path="strings.html"><a href="strings.html#extract-matches"><i class="fa fa-check"></i><b>14.4.2</b> Extract matches</a></li>
<li class="chapter" data-level="14.4.3" data-path="strings.html"><a href="strings.html#grouped-matches"><i class="fa fa-check"></i><b>14.4.3</b> Grouped matches</a></li>
<li class="chapter" data-level="14.4.4" data-path="strings.html"><a href="strings.html#replacing-matches"><i class="fa fa-check"></i><b>14.4.4</b> Replacing matches</a></li>
<li class="chapter" data-level="14.4.5" data-path="strings.html"><a href="strings.html#splitting"><i class="fa fa-check"></i><b>14.4.5</b> Splitting</a></li>
<li class="chapter" data-level="14.4.6" data-path="strings.html"><a href="strings.html#find-matches"><i class="fa fa-check"></i><b>14.4.6</b> Find matches</a></li>
</ul></li>
<li class="chapter" data-level="14.5" data-path="strings.html"><a href="strings.html#other-types-of-pattern"><i class="fa fa-check"></i><b>14.5</b> Other types of pattern</a>
<ul>
<li class="chapter" data-level="14.5.1" data-path="strings.html"><a href="strings.html#exercises-43"><i class="fa fa-check"></i><b>14.5.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="14.6" data-path="strings.html"><a href="strings.html#other-uses-of-regular-expressions"><i class="fa fa-check"></i><b>14.6</b> Other uses of regular expressions</a></li>
<li class="chapter" data-level="14.7" data-path="strings.html"><a href="strings.html#stringi"><i class="fa fa-check"></i><b>14.7</b> stringi</a>
<ul>
<li class="chapter" data-level="14.7.1" data-path="strings.html"><a href="strings.html#exercises-44"><i class="fa fa-check"></i><b>14.7.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="factors.html"><a href="factors.html"><i class="fa fa-check"></i><b>15</b> Factors</a>
<ul>
<li class="chapter" data-level="15.1" data-path="factors.html"><a href="factors.html#introduction-9"><i class="fa fa-check"></i><b>15.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="15.1.1" data-path="factors.html"><a href="factors.html#prerequisites-9"><i class="fa fa-check"></i><b>15.1.1</b> Prerequisites</a></li>
<li class="chapter" data-level="15.1.2" data-path="factors.html"><a href="factors.html#learning-more-1"><i class="fa fa-check"></i><b>15.1.2</b> Learning more</a></li>
</ul></li>
<li class="chapter" data-level="15.2" data-path="factors.html"><a href="factors.html#creating-factors"><i class="fa fa-check"></i><b>15.2</b> Creating factors</a></li>
<li class="chapter" data-level="15.3" data-path="factors.html"><a href="factors.html#general-social-survey"><i class="fa fa-check"></i><b>15.3</b> General Social Survey</a>
<ul>
<li class="chapter" data-level="15.3.1" data-path="factors.html"><a href="factors.html#exercise"><i class="fa fa-check"></i><b>15.3.1</b> Exercise</a></li>
</ul></li>
<li class="chapter" data-level="15.4" data-path="factors.html"><a href="factors.html#modifying-factor-order"><i class="fa fa-check"></i><b>15.4</b> Modifying factor order</a>
<ul>
<li class="chapter" data-level="15.4.1" data-path="factors.html"><a href="factors.html#exercises-45"><i class="fa fa-check"></i><b>15.4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="15.5" data-path="factors.html"><a href="factors.html#modifying-factor-levels"><i class="fa fa-check"></i><b>15.5</b> Modifying factor levels</a>
<ul>
<li class="chapter" data-level="15.5.1" data-path="factors.html"><a href="factors.html#exercises-46"><i class="fa fa-check"></i><b>15.5.1</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="dates-and-times.html"><a href="dates-and-times.html"><i class="fa fa-check"></i><b>16</b> Dates and times</a>
<ul>
<li class="chapter" data-level="16.1" data-path="dates-and-times.html"><a href="dates-and-times.html#introduction-10"><i class="fa fa-check"></i><b>16.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="16.1.1" data-path="dates-and-times.html"><a href="dates-and-times.html#prerequisites-10"><i class="fa fa-check"></i><b>16.1.1</b> Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="16.2" data-path="dates-and-times.html"><a href="dates-and-times.html#creating-datetimes"><i class="fa fa-check"></i><b>16.2</b> Creating date/times</a>
<ul>
<li class="chapter" data-level="16.2.1" data-path="dates-and-times.html"><a href="dates-and-times.html#from-strings"><i class="fa fa-check"></i><b>16.2.1</b> From strings</a></li>
<li class="chapter" data-level="16.2.2" data-path="dates-and-times.html"><a href="dates-and-times.html#from-individual-components"><i class="fa fa-check"></i><b>16.2.2</b> From individual components</a></li>
<li class="chapter" data-level="16.2.3" data-path="dates-and-times.html"><a href="dates-and-times.html#from-other-types"><i class="fa fa-check"></i><b>16.2.3</b> From other types</a></li>
<li class="chapter" data-level="16.2.4" data-path="dates-and-times.html"><a href="dates-and-times.html#exercises-47"><i class="fa fa-check"></i><b>16.2.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="16.3" data-path="dates-and-times.html"><a href="dates-and-times.html#date-time-components"><i class="fa fa-check"></i><b>16.3</b> Date-time components</a>
<ul>
<li class="chapter" data-level="16.3.1" data-path="dates-and-times.html"><a href="dates-and-times.html#getting-components"><i class="fa fa-check"></i><b>16.3.1</b> Getting components</a></li>
<li class="chapter" data-level="16.3.2" data-path="dates-and-times.html"><a href="dates-and-times.html#rounding"><i class="fa fa-check"></i><b>16.3.2</b> Rounding</a></li>
<li class="chapter" data-level="16.3.3" data-path="dates-and-times.html"><a href="dates-and-times.html#setting-components"><i class="fa fa-check"></i><b>16.3.3</b> Setting components</a></li>
<li class="chapter" data-level="16.3.4" data-path="dates-and-times.html"><a href="dates-and-times.html#exercises-48"><i class="fa fa-check"></i><b>16.3.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="16.4" data-path="dates-and-times.html"><a href="dates-and-times.html#time-spans"><i class="fa fa-check"></i><b>16.4</b> Time spans</a>
<ul>
<li class="chapter" data-level="16.4.1" data-path="dates-and-times.html"><a href="dates-and-times.html#durations"><i class="fa fa-check"></i><b>16.4.1</b> Durations</a></li>
<li class="chapter" data-level="16.4.2" data-path="dates-and-times.html"><a href="dates-and-times.html#periods"><i class="fa fa-check"></i><b>16.4.2</b> Periods</a></li>
<li class="chapter" data-level="16.4.3" data-path="dates-and-times.html"><a href="dates-and-times.html#intervals"><i class="fa fa-check"></i><b>16.4.3</b> Intervals</a></li>
<li class="chapter" data-level="16.4.4" data-path="dates-and-times.html"><a href="dates-and-times.html#summary-1"><i class="fa fa-check"></i><b>16.4.4</b> Summary</a></li>
<li class="chapter" data-level="16.4.5" data-path="dates-and-times.html"><a href="dates-and-times.html#exercises-49"><i class="fa fa-check"></i><b>16.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="16.5" data-path="dates-and-times.html"><a href="dates-and-times.html#time-zones"><i class="fa fa-check"></i><b>16.5</b> Time zones</a></li>
</ul></li>
<li class="part"><span><b>III Program</b></span></li>
<li class="chapter" data-level="17" data-path="program-intro.html"><a href="program-intro.html"><i class="fa fa-check"></i><b>17</b> Introduction</a>
<ul>
<li class="chapter" data-level="17.1" data-path="program-intro.html"><a href="program-intro.html#learning-more-2"><i class="fa fa-check"></i><b>17.1</b> Learning more</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="pipes.html"><a href="pipes.html"><i class="fa fa-check"></i><b>18</b> Pipes</a>
<ul>
<li class="chapter" data-level="18.1" data-path="pipes.html"><a href="pipes.html#introduction-11"><i class="fa fa-check"></i><b>18.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="18.1.1" data-path="pipes.html"><a href="pipes.html#prerequisites-11"><i class="fa fa-check"></i><b>18.1.1</b> Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="pipes.html"><a href="pipes.html#piping-alternatives"><i class="fa fa-check"></i><b>18.2</b> Piping alternatives</a>
<ul>
<li class="chapter" data-level="18.2.1" data-path="pipes.html"><a href="pipes.html#intermediate-steps"><i class="fa fa-check"></i><b>18.2.1</b> Intermediate steps</a></li>
<li class="chapter" data-level="18.2.2" data-path="pipes.html"><a href="pipes.html#overwrite-the-original"><i class="fa fa-check"></i><b>18.2.2</b> Overwrite the original</a></li>
<li class="chapter" data-level="18.2.3" data-path="pipes.html"><a href="pipes.html#function-composition"><i class="fa fa-check"></i><b>18.2.3</b> Function composition</a></li>
<li class="chapter" data-level="18.2.4" data-path="pipes.html"><a href="pipes.html#use-the-pipe"><i class="fa fa-check"></i><b>18.2.4</b> Use the pipe</a></li>
</ul></li>
<li class="chapter" data-level="18.3" data-path="pipes.html"><a href="pipes.html#when-not-to-use-the-pipe"><i class="fa fa-check"></i><b>18.3</b> When not to use the pipe</a></li>
<li class="chapter" data-level="18.4" data-path="pipes.html"><a href="pipes.html#other-tools-from-magrittr"><i class="fa fa-check"></i><b>18.4</b> Other tools from magrittr</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="functions.html"><a href="functions.html"><i class="fa fa-check"></i><b>19</b> Functions</a>
<ul>
<li class="chapter" data-level="19.1" data-path="functions.html"><a href="functions.html#introduction-12"><i class="fa fa-check"></i><b>19.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="19.1.1" data-path="functions.html"><a href="functions.html#prerequisites-12"><i class="fa fa-check"></i><b>19.1.1</b> Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="19.2" data-path="functions.html"><a href="functions.html#when-should-you-write-a-function"><i class="fa fa-check"></i><b>19.2</b> When should you write a function?</a>
<ul>
<li class="chapter" data-level="19.2.1" data-path="functions.html"><a href="functions.html#exercises-50"><i class="fa fa-check"></i><b>19.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.3" data-path="functions.html"><a href="functions.html#functions-are-for-humans-and-computers"><i class="fa fa-check"></i><b>19.3</b> Functions are for humans and computers</a>
<ul>
<li class="chapter" data-level="19.3.1" data-path="functions.html"><a href="functions.html#exercises-51"><i class="fa fa-check"></i><b>19.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="functions.html"><a href="functions.html#conditional-execution"><i class="fa fa-check"></i><b>19.4</b> Conditional execution</a>
<ul>
<li class="chapter" data-level="19.4.1" data-path="functions.html"><a href="functions.html#conditions"><i class="fa fa-check"></i><b>19.4.1</b> Conditions</a></li>
<li class="chapter" data-level="19.4.2" data-path="functions.html"><a href="functions.html#multiple-conditions"><i class="fa fa-check"></i><b>19.4.2</b> Multiple conditions</a></li>
<li class="chapter" data-level="19.4.3" data-path="functions.html"><a href="functions.html#code-style"><i class="fa fa-check"></i><b>19.4.3</b> Code style</a></li>
<li class="chapter" data-level="19.4.4" data-path="functions.html"><a href="functions.html#exercises-52"><i class="fa fa-check"></i><b>19.4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.5" data-path="functions.html"><a href="functions.html#function-arguments"><i class="fa fa-check"></i><b>19.5</b> Function arguments</a>
<ul>
<li class="chapter" data-level="19.5.1" data-path="functions.html"><a href="functions.html#choosing-names"><i class="fa fa-check"></i><b>19.5.1</b> Choosing names</a></li>
<li class="chapter" data-level="19.5.2" data-path="functions.html"><a href="functions.html#checking-values"><i class="fa fa-check"></i><b>19.5.2</b> Checking values</a></li>
<li class="chapter" data-level="19.5.3" data-path="functions.html"><a href="functions.html#dot-dot-dot"><i class="fa fa-check"></i><b>19.5.3</b> Dot-dot-dot (…)</a></li>
<li class="chapter" data-level="19.5.4" data-path="functions.html"><a href="functions.html#lazy-evaluation"><i class="fa fa-check"></i><b>19.5.4</b> Lazy evaluation</a></li>
<li class="chapter" data-level="19.5.5" data-path="functions.html"><a href="functions.html#exercises-53"><i class="fa fa-check"></i><b>19.5.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="19.6" data-path="functions.html"><a href="functions.html#return-values"><i class="fa fa-check"></i><b>19.6</b> Return values</a>
<ul>
<li class="chapter" data-level="19.6.1" data-path="functions.html"><a href="functions.html#explicit-return-statements"><i class="fa fa-check"></i><b>19.6.1</b> Explicit return statements</a></li>
<li class="chapter" data-level="19.6.2" data-path="functions.html"><a href="functions.html#writing-pipeable-functions"><i class="fa fa-check"></i><b>19.6.2</b> Writing pipeable functions</a></li>
</ul></li>
<li class="chapter" data-level="19.7" data-path="functions.html"><a href="functions.html#environment"><i class="fa fa-check"></i><b>19.7</b> Environment</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="vectors.html"><a href="vectors.html"><i class="fa fa-check"></i><b>20</b> Vectors</a>
<ul>
<li class="chapter" data-level="20.1" data-path="vectors.html"><a href="vectors.html#introduction-13"><i class="fa fa-check"></i><b>20.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="20.1.1" data-path="vectors.html"><a href="vectors.html#prerequisites-13"><i class="fa fa-check"></i><b>20.1.1</b> Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="20.2" data-path="vectors.html"><a href="vectors.html#vector-basics"><i class="fa fa-check"></i><b>20.2</b> Vector basics</a></li>
<li class="chapter" data-level="20.3" data-path="vectors.html"><a href="vectors.html#important-types-of-atomic-vector"><i class="fa fa-check"></i><b>20.3</b> Important types of atomic vector</a>
<ul>
<li class="chapter" data-level="20.3.1" data-path="vectors.html"><a href="vectors.html#logical"><i class="fa fa-check"></i><b>20.3.1</b> Logical</a></li>
<li class="chapter" data-level="20.3.2" data-path="vectors.html"><a href="vectors.html#numeric"><i class="fa fa-check"></i><b>20.3.2</b> Numeric</a></li>
<li class="chapter" data-level="20.3.3" data-path="vectors.html"><a href="vectors.html#character"><i class="fa fa-check"></i><b>20.3.3</b> Character</a></li>
<li class="chapter" data-level="20.3.4" data-path="vectors.html"><a href="vectors.html#missing-values-4"><i class="fa fa-check"></i><b>20.3.4</b> Missing values</a></li>
<li class="chapter" data-level="20.3.5" data-path="vectors.html"><a href="vectors.html#exercises-54"><i class="fa fa-check"></i><b>20.3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.4" data-path="vectors.html"><a href="vectors.html#using-atomic-vectors"><i class="fa fa-check"></i><b>20.4</b> Using atomic vectors</a>
<ul>
<li class="chapter" data-level="20.4.1" data-path="vectors.html"><a href="vectors.html#coercion"><i class="fa fa-check"></i><b>20.4.1</b> Coercion</a></li>
<li class="chapter" data-level="20.4.2" data-path="vectors.html"><a href="vectors.html#test-functions"><i class="fa fa-check"></i><b>20.4.2</b> Test functions</a></li>
<li class="chapter" data-level="20.4.3" data-path="vectors.html"><a href="vectors.html#scalars-and-recycling-rules"><i class="fa fa-check"></i><b>20.4.3</b> Scalars and recycling rules</a></li>
<li class="chapter" data-level="20.4.4" data-path="vectors.html"><a href="vectors.html#naming-vectors"><i class="fa fa-check"></i><b>20.4.4</b> Naming vectors</a></li>
<li class="chapter" data-level="20.4.5" data-path="vectors.html"><a href="vectors.html#vector-subsetting"><i class="fa fa-check"></i><b>20.4.5</b> Subsetting</a></li>
<li class="chapter" data-level="20.4.6" data-path="vectors.html"><a href="vectors.html#exercises-55"><i class="fa fa-check"></i><b>20.4.6</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.5" data-path="vectors.html"><a href="vectors.html#lists"><i class="fa fa-check"></i><b>20.5</b> Recursive vectors (lists)</a>
<ul>
<li class="chapter" data-level="20.5.1" data-path="vectors.html"><a href="vectors.html#visualising-lists"><i class="fa fa-check"></i><b>20.5.1</b> Visualising lists</a></li>
<li class="chapter" data-level="20.5.2" data-path="vectors.html"><a href="vectors.html#subsetting-1"><i class="fa fa-check"></i><b>20.5.2</b> Subsetting</a></li>
<li class="chapter" data-level="20.5.3" data-path="vectors.html"><a href="vectors.html#lists-of-condiments"><i class="fa fa-check"></i><b>20.5.3</b> Lists of condiments</a></li>
<li class="chapter" data-level="20.5.4" data-path="vectors.html"><a href="vectors.html#exercises-56"><i class="fa fa-check"></i><b>20.5.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="20.6" data-path="vectors.html"><a href="vectors.html#attributes"><i class="fa fa-check"></i><b>20.6</b> Attributes</a></li>
<li class="chapter" data-level="20.7" data-path="vectors.html"><a href="vectors.html#augmented-vectors"><i class="fa fa-check"></i><b>20.7</b> Augmented vectors</a>
<ul>
<li class="chapter" data-level="20.7.1" data-path="vectors.html"><a href="vectors.html#factors-1"><i class="fa fa-check"></i><b>20.7.1</b> Factors</a></li>
<li class="chapter" data-level="20.7.2" data-path="vectors.html"><a href="vectors.html#dates-and-date-times"><i class="fa fa-check"></i><b>20.7.2</b> Dates and date-times</a></li>
<li class="chapter" data-level="20.7.3" data-path="vectors.html"><a href="vectors.html#tibbles-1"><i class="fa fa-check"></i><b>20.7.3</b> Tibbles</a></li>
<li class="chapter" data-level="20.7.4" data-path="vectors.html"><a href="vectors.html#exercises-57"><i class="fa fa-check"></i><b>20.7.4</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="21" data-path="iteration.html"><a href="iteration.html"><i class="fa fa-check"></i><b>21</b> Iteration</a>
<ul>
<li class="chapter" data-level="21.1" data-path="iteration.html"><a href="iteration.html#introduction-14"><i class="fa fa-check"></i><b>21.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="21.1.1" data-path="iteration.html"><a href="iteration.html#prerequisites-14"><i class="fa fa-check"></i><b>21.1.1</b> Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="21.2" data-path="iteration.html"><a href="iteration.html#for-loops"><i class="fa fa-check"></i><b>21.2</b> For loops</a>
<ul>
<li class="chapter" data-level="21.2.1" data-path="iteration.html"><a href="iteration.html#exercises-58"><i class="fa fa-check"></i><b>21.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="21.3" data-path="iteration.html"><a href="iteration.html#for-loop-variations"><i class="fa fa-check"></i><b>21.3</b> For loop variations</a>
<ul>
<li class="chapter" data-level="21.3.1" data-path="iteration.html"><a href="iteration.html#modifying-an-existing-object"><i class="fa fa-check"></i><b>21.3.1</b> Modifying an existing object</a></li>
<li class="chapter" data-level="21.3.2" data-path="iteration.html"><a href="iteration.html#looping-patterns"><i class="fa fa-check"></i><b>21.3.2</b> Looping patterns</a></li>
<li class="chapter" data-level="21.3.3" data-path="iteration.html"><a href="iteration.html#unknown-output-length"><i class="fa fa-check"></i><b>21.3.3</b> Unknown output length</a></li>
<li class="chapter" data-level="21.3.4" data-path="iteration.html"><a href="iteration.html#unknown-sequence-length"><i class="fa fa-check"></i><b>21.3.4</b> Unknown sequence length</a></li>
<li class="chapter" data-level="21.3.5" data-path="iteration.html"><a href="iteration.html#exercises-59"><i class="fa fa-check"></i><b>21.3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="21.4" data-path="iteration.html"><a href="iteration.html#for-loops-vs.-functionals"><i class="fa fa-check"></i><b>21.4</b> For loops vs. functionals</a>
<ul>
<li class="chapter" data-level="21.4.1" data-path="iteration.html"><a href="iteration.html#exercises-60"><i class="fa fa-check"></i><b>21.4.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="21.5" data-path="iteration.html"><a href="iteration.html#the-map-functions"><i class="fa fa-check"></i><b>21.5</b> The map functions</a>
<ul>
<li class="chapter" data-level="21.5.1" data-path="iteration.html"><a href="iteration.html#shortcuts"><i class="fa fa-check"></i><b>21.5.1</b> Shortcuts</a></li>
<li class="chapter" data-level="21.5.2" data-path="iteration.html"><a href="iteration.html#base-r"><i class="fa fa-check"></i><b>21.5.2</b> Base R</a></li>
<li class="chapter" data-level="21.5.3" data-path="iteration.html"><a href="iteration.html#exercises-61"><i class="fa fa-check"></i><b>21.5.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="21.6" data-path="iteration.html"><a href="iteration.html#dealing-with-failure"><i class="fa fa-check"></i><b>21.6</b> Dealing with failure</a></li>
<li class="chapter" data-level="21.7" data-path="iteration.html"><a href="iteration.html#mapping-over-multiple-arguments"><i class="fa fa-check"></i><b>21.7</b> Mapping over multiple arguments</a>
<ul>
<li class="chapter" data-level="21.7.1" data-path="iteration.html"><a href="iteration.html#invoking-different-functions"><i class="fa fa-check"></i><b>21.7.1</b> Invoking different functions</a></li>
</ul></li>
<li class="chapter" data-level="21.8" data-path="iteration.html"><a href="iteration.html#walk"><i class="fa fa-check"></i><b>21.8</b> Walk</a></li>
<li class="chapter" data-level="21.9" data-path="iteration.html"><a href="iteration.html#other-patterns-of-for-loops"><i class="fa fa-check"></i><b>21.9</b> Other patterns of for loops</a>
<ul>
<li class="chapter" data-level="21.9.1" data-path="iteration.html"><a href="iteration.html#predicate-functions"><i class="fa fa-check"></i><b>21.9.1</b> Predicate functions</a></li>
<li class="chapter" data-level="21.9.2" data-path="iteration.html"><a href="iteration.html#reduce-and-accumulate"><i class="fa fa-check"></i><b>21.9.2</b> Reduce and accumulate</a></li>
<li class="chapter" data-level="21.9.3" data-path="iteration.html"><a href="iteration.html#exercises-62"><i class="fa fa-check"></i><b>21.9.3</b> Exercises</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>IV Model</b></span></li>
<li class="chapter" data-level="22" data-path="model-intro.html"><a href="model-intro.html"><i class="fa fa-check"></i><b>22</b> Introduction</a>
<ul>
<li class="chapter" data-level="22.1" data-path="model-intro.html"><a href="model-intro.html#hypothesis-generation-vs.-hypothesis-confirmation"><i class="fa fa-check"></i><b>22.1</b> Hypothesis generation vs. hypothesis confirmation</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="model-basics.html"><a href="model-basics.html"><i class="fa fa-check"></i><b>23</b> Model basics</a>
<ul>
<li class="chapter" data-level="23.1" data-path="model-basics.html"><a href="model-basics.html#introduction-15"><i class="fa fa-check"></i><b>23.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="23.1.1" data-path="model-basics.html"><a href="model-basics.html#prerequisites-15"><i class="fa fa-check"></i><b>23.1.1</b> Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="23.2" data-path="model-basics.html"><a href="model-basics.html#a-simple-model"><i class="fa fa-check"></i><b>23.2</b> A simple model</a>
<ul>
<li class="chapter" data-level="23.2.1" data-path="model-basics.html"><a href="model-basics.html#exercises-63"><i class="fa fa-check"></i><b>23.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="23.3" data-path="model-basics.html"><a href="model-basics.html#visualising-models"><i class="fa fa-check"></i><b>23.3</b> Visualising models</a>
<ul>
<li class="chapter" data-level="23.3.1" data-path="model-basics.html"><a href="model-basics.html#predictions"><i class="fa fa-check"></i><b>23.3.1</b> Predictions</a></li>
<li class="chapter" data-level="23.3.2" data-path="model-basics.html"><a href="model-basics.html#residuals"><i class="fa fa-check"></i><b>23.3.2</b> Residuals</a></li>
<li class="chapter" data-level="23.3.3" data-path="model-basics.html"><a href="model-basics.html#exercises-64"><i class="fa fa-check"></i><b>23.3.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="23.4" data-path="model-basics.html"><a href="model-basics.html#formulas-and-model-families"><i class="fa fa-check"></i><b>23.4</b> Formulas and model families</a>
<ul>
<li class="chapter" data-level="23.4.1" data-path="model-basics.html"><a href="model-basics.html#categorical-variables"><i class="fa fa-check"></i><b>23.4.1</b> Categorical variables</a></li>
<li class="chapter" data-level="23.4.2" data-path="model-basics.html"><a href="model-basics.html#interactions-continuous-and-categorical"><i class="fa fa-check"></i><b>23.4.2</b> Interactions (continuous and categorical)</a></li>
<li class="chapter" data-level="23.4.3" data-path="model-basics.html"><a href="model-basics.html#interactions-two-continuous"><i class="fa fa-check"></i><b>23.4.3</b> Interactions (two continuous)</a></li>
<li class="chapter" data-level="23.4.4" data-path="model-basics.html"><a href="model-basics.html#transformations"><i class="fa fa-check"></i><b>23.4.4</b> Transformations</a></li>
<li class="chapter" data-level="23.4.5" data-path="model-basics.html"><a href="model-basics.html#exercises-65"><i class="fa fa-check"></i><b>23.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="23.5" data-path="model-basics.html"><a href="model-basics.html#missing-values-5"><i class="fa fa-check"></i><b>23.5</b> Missing values</a></li>
<li class="chapter" data-level="23.6" data-path="model-basics.html"><a href="model-basics.html#other-model-families"><i class="fa fa-check"></i><b>23.6</b> Other model families</a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="model-building.html"><a href="model-building.html"><i class="fa fa-check"></i><b>24</b> Model building</a>
<ul>
<li class="chapter" data-level="24.1" data-path="model-building.html"><a href="model-building.html#introduction-16"><i class="fa fa-check"></i><b>24.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="24.1.1" data-path="model-building.html"><a href="model-building.html#prerequisites-16"><i class="fa fa-check"></i><b>24.1.1</b> Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="24.2" data-path="model-building.html"><a href="model-building.html#diamond-prices"><i class="fa fa-check"></i><b>24.2</b> Why are low quality diamonds more expensive?</a>
<ul>
<li class="chapter" data-level="24.2.1" data-path="model-building.html"><a href="model-building.html#price-and-carat"><i class="fa fa-check"></i><b>24.2.1</b> Price and carat</a></li>
<li class="chapter" data-level="24.2.2" data-path="model-building.html"><a href="model-building.html#a-more-complicated-model"><i class="fa fa-check"></i><b>24.2.2</b> A more complicated model</a></li>
<li class="chapter" data-level="24.2.3" data-path="model-building.html"><a href="model-building.html#exercises-66"><i class="fa fa-check"></i><b>24.2.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.3" data-path="model-building.html"><a href="model-building.html#what-affects-the-number-of-daily-flights"><i class="fa fa-check"></i><b>24.3</b> What affects the number of daily flights?</a>
<ul>
<li class="chapter" data-level="24.3.1" data-path="model-building.html"><a href="model-building.html#day-of-week"><i class="fa fa-check"></i><b>24.3.1</b> Day of week</a></li>
<li class="chapter" data-level="24.3.2" data-path="model-building.html"><a href="model-building.html#seasonal-saturday-effect"><i class="fa fa-check"></i><b>24.3.2</b> Seasonal Saturday effect</a></li>
<li class="chapter" data-level="24.3.3" data-path="model-building.html"><a href="model-building.html#computed-variables"><i class="fa fa-check"></i><b>24.3.3</b> Computed variables</a></li>
<li class="chapter" data-level="24.3.4" data-path="model-building.html"><a href="model-building.html#time-of-year-an-alternative-approach"><i class="fa fa-check"></i><b>24.3.4</b> Time of year: an alternative approach</a></li>
<li class="chapter" data-level="24.3.5" data-path="model-building.html"><a href="model-building.html#exercises-67"><i class="fa fa-check"></i><b>24.3.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="24.4" data-path="model-building.html"><a href="model-building.html#learning-more-about-models"><i class="fa fa-check"></i><b>24.4</b> Learning more about models</a></li>
</ul></li>
<li class="chapter" data-level="25" data-path="many-models.html"><a href="many-models.html"><i class="fa fa-check"></i><b>25</b> Many models</a>
<ul>
<li class="chapter" data-level="25.1" data-path="many-models.html"><a href="many-models.html#introduction-17"><i class="fa fa-check"></i><b>25.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="25.1.1" data-path="many-models.html"><a href="many-models.html#prerequisites-17"><i class="fa fa-check"></i><b>25.1.1</b> Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="25.2" data-path="many-models.html"><a href="many-models.html#gapminder"><i class="fa fa-check"></i><b>25.2</b> gapminder</a>
<ul>
<li class="chapter" data-level="25.2.1" data-path="many-models.html"><a href="many-models.html#nested-data"><i class="fa fa-check"></i><b>25.2.1</b> Nested data</a></li>
<li class="chapter" data-level="25.2.2" data-path="many-models.html"><a href="many-models.html#list-columns"><i class="fa fa-check"></i><b>25.2.2</b> List-columns</a></li>
<li class="chapter" data-level="25.2.3" data-path="many-models.html"><a href="many-models.html#unnesting"><i class="fa fa-check"></i><b>25.2.3</b> Unnesting</a></li>
<li class="chapter" data-level="25.2.4" data-path="many-models.html"><a href="many-models.html#model-quality"><i class="fa fa-check"></i><b>25.2.4</b> Model quality</a></li>
<li class="chapter" data-level="25.2.5" data-path="many-models.html"><a href="many-models.html#exercises-68"><i class="fa fa-check"></i><b>25.2.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="25.3" data-path="many-models.html"><a href="many-models.html#list-columns-1"><i class="fa fa-check"></i><b>25.3</b> List-columns</a></li>
<li class="chapter" data-level="25.4" data-path="many-models.html"><a href="many-models.html#creating-list-columns"><i class="fa fa-check"></i><b>25.4</b> Creating list-columns</a>
<ul>
<li class="chapter" data-level="25.4.1" data-path="many-models.html"><a href="many-models.html#with-nesting"><i class="fa fa-check"></i><b>25.4.1</b> With nesting</a></li>
<li class="chapter" data-level="25.4.2" data-path="many-models.html"><a href="many-models.html#from-vectorised-functions"><i class="fa fa-check"></i><b>25.4.2</b> From vectorised functions</a></li>
<li class="chapter" data-level="25.4.3" data-path="many-models.html"><a href="many-models.html#from-multivalued-summaries"><i class="fa fa-check"></i><b>25.4.3</b> From multivalued summaries</a></li>
<li class="chapter" data-level="25.4.4" data-path="many-models.html"><a href="many-models.html#from-a-named-list"><i class="fa fa-check"></i><b>25.4.4</b> From a named list</a></li>
<li class="chapter" data-level="25.4.5" data-path="many-models.html"><a href="many-models.html#exercises-69"><i class="fa fa-check"></i><b>25.4.5</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="25.5" data-path="many-models.html"><a href="many-models.html#simplifying-list-columns"><i class="fa fa-check"></i><b>25.5</b> Simplifying list-columns</a>
<ul>
<li class="chapter" data-level="25.5.1" data-path="many-models.html"><a href="many-models.html#list-to-vector"><i class="fa fa-check"></i><b>25.5.1</b> List to vector</a></li>
<li class="chapter" data-level="25.5.2" data-path="many-models.html"><a href="many-models.html#unnesting-1"><i class="fa fa-check"></i><b>25.5.2</b> Unnesting</a></li>
<li class="chapter" data-level="25.5.3" data-path="many-models.html"><a href="many-models.html#exercises-70"><i class="fa fa-check"></i><b>25.5.3</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="25.6" data-path="many-models.html"><a href="many-models.html#making-tidy-data-with-broom"><i class="fa fa-check"></i><b>25.6</b> Making tidy data with broom</a></li>
</ul></li>
<li class="part"><span><b>V Communicate</b></span></li>
<li class="chapter" data-level="26" data-path="communicate-intro.html"><a href="communicate-intro.html"><i class="fa fa-check"></i><b>26</b> Introduction</a></li>
<li class="chapter" data-level="27" data-path="r-markdown.html"><a href="r-markdown.html"><i class="fa fa-check"></i><b>27</b> R Markdown</a>
<ul>
<li class="chapter" data-level="27.1" data-path="r-markdown.html"><a href="r-markdown.html#introduction-18"><i class="fa fa-check"></i><b>27.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="27.1.1" data-path="r-markdown.html"><a href="r-markdown.html#prerequisites-18"><i class="fa fa-check"></i><b>27.1.1</b> Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="27.2" data-path="r-markdown.html"><a href="r-markdown.html#r-markdown-basics"><i class="fa fa-check"></i><b>27.2</b> R Markdown basics</a>
<ul>
<li class="chapter" data-level="27.2.1" data-path="r-markdown.html"><a href="r-markdown.html#exercises-71"><i class="fa fa-check"></i><b>27.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="27.3" data-path="r-markdown.html"><a href="r-markdown.html#text-formatting-with-markdown"><i class="fa fa-check"></i><b>27.3</b> Text formatting with Markdown</a>
<ul>
<li class="chapter" data-level="27.3.1" data-path="r-markdown.html"><a href="r-markdown.html#exercises-72"><i class="fa fa-check"></i><b>27.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="27.4" data-path="r-markdown.html"><a href="r-markdown.html#code-chunks"><i class="fa fa-check"></i><b>27.4</b> Code chunks</a>
<ul>
<li class="chapter" data-level="27.4.1" data-path="r-markdown.html"><a href="r-markdown.html#chunk-name"><i class="fa fa-check"></i><b>27.4.1</b> Chunk name</a></li>
<li class="chapter" data-level="27.4.2" data-path="r-markdown.html"><a href="r-markdown.html#chunk-options"><i class="fa fa-check"></i><b>27.4.2</b> Chunk options</a></li>
<li class="chapter" data-level="27.4.3" data-path="r-markdown.html"><a href="r-markdown.html#table"><i class="fa fa-check"></i><b>27.4.3</b> Table</a></li>
<li class="chapter" data-level="27.4.4" data-path="r-markdown.html"><a href="r-markdown.html#caching"><i class="fa fa-check"></i><b>27.4.4</b> Caching</a></li>
<li class="chapter" data-level="27.4.5" data-path="r-markdown.html"><a href="r-markdown.html#global-options"><i class="fa fa-check"></i><b>27.4.5</b> Global options</a></li>
<li class="chapter" data-level="27.4.6" data-path="r-markdown.html"><a href="r-markdown.html#inline-code"><i class="fa fa-check"></i><b>27.4.6</b> Inline code</a></li>
<li class="chapter" data-level="27.4.7" data-path="r-markdown.html"><a href="r-markdown.html#exercises-73"><i class="fa fa-check"></i><b>27.4.7</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="27.5" data-path="r-markdown.html"><a href="r-markdown.html#troubleshooting"><i class="fa fa-check"></i><b>27.5</b> Troubleshooting</a></li>
<li class="chapter" data-level="27.6" data-path="r-markdown.html"><a href="r-markdown.html#yaml-header"><i class="fa fa-check"></i><b>27.6</b> YAML header</a>
<ul>
<li class="chapter" data-level="27.6.1" data-path="r-markdown.html"><a href="r-markdown.html#parameters"><i class="fa fa-check"></i><b>27.6.1</b> Parameters</a></li>
<li class="chapter" data-level="27.6.2" data-path="r-markdown.html"><a href="r-markdown.html#bibliographies-and-citations"><i class="fa fa-check"></i><b>27.6.2</b> Bibliographies and Citations</a></li>
</ul></li>
<li class="chapter" data-level="27.7" data-path="r-markdown.html"><a href="r-markdown.html#learning-more-3"><i class="fa fa-check"></i><b>27.7</b> Learning more</a></li>
</ul></li>
<li class="chapter" data-level="28" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html"><i class="fa fa-check"></i><b>28</b> Graphics for communication</a>
<ul>
<li class="chapter" data-level="28.1" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#introduction-19"><i class="fa fa-check"></i><b>28.1</b> Introduction</a>
<ul>
<li class="chapter" data-level="28.1.1" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#prerequisites-19"><i class="fa fa-check"></i><b>28.1.1</b> Prerequisites</a></li>
</ul></li>
<li class="chapter" data-level="28.2" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#label"><i class="fa fa-check"></i><b>28.2</b> Label</a>
<ul>
<li class="chapter" data-level="28.2.1" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#exercises-74"><i class="fa fa-check"></i><b>28.2.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="28.3" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#annotations"><i class="fa fa-check"></i><b>28.3</b> Annotations</a>
<ul>
<li class="chapter" data-level="28.3.1" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#exercises-75"><i class="fa fa-check"></i><b>28.3.1</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="28.4" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#scales"><i class="fa fa-check"></i><b>28.4</b> Scales</a>
<ul>
<li class="chapter" data-level="28.4.1" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#axis-ticks-and-legend-keys"><i class="fa fa-check"></i><b>28.4.1</b> Axis ticks and legend keys</a></li>
<li class="chapter" data-level="28.4.2" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#legend-layout"><i class="fa fa-check"></i><b>28.4.2</b> Legend layout</a></li>
<li class="chapter" data-level="28.4.3" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#replacing-a-scale"><i class="fa fa-check"></i><b>28.4.3</b> Replacing a scale</a></li>
<li class="chapter" data-level="28.4.4" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#exercises-76"><i class="fa fa-check"></i><b>28.4.4</b> Exercises</a></li>
</ul></li>
<li class="chapter" data-level="28.5" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#zooming"><i class="fa fa-check"></i><b>28.5</b> Zooming</a></li>
<li class="chapter" data-level="28.6" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#themes"><i class="fa fa-check"></i><b>28.6</b> Themes</a></li>
<li class="chapter" data-level="28.7" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#saving-your-plots"><i class="fa fa-check"></i><b>28.7</b> Saving your plots</a>
<ul>
<li class="chapter" data-level="28.7.1" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#figure-sizing"><i class="fa fa-check"></i><b>28.7.1</b> Figure sizing</a></li>
<li class="chapter" data-level="28.7.2" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#other-important-options"><i class="fa fa-check"></i><b>28.7.2</b> Other important options</a></li>
</ul></li>
<li class="chapter" data-level="28.8" data-path="graphics-for-communication.html"><a href="graphics-for-communication.html#learning-more-4"><i class="fa fa-check"></i><b>28.8</b> Learning more</a></li>
</ul></li>
<li class="chapter" data-level="29" data-path="r-markdown-formats.html"><a href="r-markdown-formats.html"><i class="fa fa-check"></i><b>29</b> R Markdown formats</a>
<ul>
<li class="chapter" data-level="29.1" data-path="r-markdown-formats.html"><a href="r-markdown-formats.html#introduction-20"><i class="fa fa-check"></i><b>29.1</b> Introduction</a></li>
<li class="chapter" data-level="29.2" data-path="r-markdown-formats.html"><a href="r-markdown-formats.html#output-options"><i class="fa fa-check"></i><b>29.2</b> Output options</a></li>
<li class="chapter" data-level="29.3" data-path="r-markdown-formats.html"><a href="r-markdown-formats.html#documents"><i class="fa fa-check"></i><b>29.3</b> Documents</a></li>
<li class="chapter" data-level="29.4" data-path="r-markdown-formats.html"><a href="r-markdown-formats.html#notebooks"><i class="fa fa-check"></i><b>29.4</b> Notebooks</a></li>
<li class="chapter" data-level="29.5" data-path="r-markdown-formats.html"><a href="r-markdown-formats.html#presentations"><i class="fa fa-check"></i><b>29.5</b> Presentations</a></li>
<li class="chapter" data-level="29.6" data-path="r-markdown-formats.html"><a href="r-markdown-formats.html#dashboards"><i class="fa fa-check"></i><b>29.6</b> Dashboards</a></li>
<li class="chapter" data-level="29.7" data-path="r-markdown-formats.html"><a href="r-markdown-formats.html#interactivity"><i class="fa fa-check"></i><b>29.7</b> Interactivity</a>
<ul>
<li class="chapter" data-level="29.7.1" data-path="r-markdown-formats.html"><a href="r-markdown-formats.html#htmlwidgets"><i class="fa fa-check"></i><b>29.7.1</b> htmlwidgets</a></li>
<li class="chapter" data-level="29.7.2" data-path="r-markdown-formats.html"><a href="r-markdown-formats.html#shiny"><i class="fa fa-check"></i><b>29.7.2</b> Shiny</a></li>
</ul></li>
<li class="chapter" data-level="29.8" data-path="r-markdown-formats.html"><a href="r-markdown-formats.html#websites"><i class="fa fa-check"></i><b>29.8</b> Websites</a></li>
<li class="chapter" data-level="29.9" data-path="r-markdown-formats.html"><a href="r-markdown-formats.html#other-formats"><i class="fa fa-check"></i><b>29.9</b> Other formats</a></li>
<li class="chapter" data-level="29.10" data-path="r-markdown-formats.html"><a href="r-markdown-formats.html#learning-more-5"><i class="fa fa-check"></i><b>29.10</b> Learning more</a></li>
</ul></li>
<li class="chapter" data-level="30" data-path="r-markdown-workflow.html"><a href="r-markdown-workflow.html"><i class="fa fa-check"></i><b>30</b> R Markdown workflow</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">R for Data Science (2e)</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="many-models" class="section level1" number="25">
<h1><span class="header-section-number">25</span> Many models</h1>
<div id="introduction-17" class="section level2" number="25.1">
<h2><span class="header-section-number">25.1</span> Introduction</h2>
<p>In this chapter you’re going to learn three powerful ideas that help you to work with large numbers of models with ease:</p>
<ol style="list-style-type: decimal">
<li><p>Using many simple models to better understand complex datasets.</p></li>
<li><p>Using list-columns to store arbitrary data structures in a data frame.
For example, this will allow you to have a column that contains linear
models.</p></li>
<li><p>Using the <strong>broom</strong> package, by David Robinson, to turn models into tidy
data. This is a powerful technique for working with large numbers of models
because once you have tidy data, you can apply all of the techniques that
you’ve learned about earlier in the book.</p></li>
</ol>
<p>We’ll start by diving into a motivating example using data about life expectancy around the world. It’s a small dataset but it illustrates how important modelling can be for improving your visualisations. We’ll use a large number of simple models to partition out some of the strongest signals so we can see the subtler signals that remain. We’ll also see how model summaries can help us pick out outliers and unusual trends.</p>
<p>The following sections will dive into more detail about the individual techniques:</p>
<ol style="list-style-type: decimal">
<li><p>In <a href="many-models.html#list-columns-1">list-columns</a>, you’ll learn more about the list-column data structure,
and why it’s valid to put lists in data frames.</p></li>
<li><p>In <a href="many-models.html#creating-list-columns">creating list-columns</a>, you’ll learn the three main ways in which you’ll
create list-columns.</p></li>
<li><p>In <a href="many-models.html#simplifying-list-columns">simplifying list-columns</a> you’ll learn how to convert list-columns back
to regular atomic vectors (or sets of atomic vectors) so you can work
with them more easily.</p></li>
<li><p>In <a href="many-models.html#making-tidy-data-with-broom">making tidy data with broom</a>, you’ll learn about the full set of tools
provided by broom, and see how they can be applied to other types of
data structure.</p></li>
</ol>
<p>This chapter is somewhat aspirational: if this book is your first introduction to R, this chapter is likely to be a struggle. It requires you to have deeply internalised ideas about modelling, data structures, and iteration. So don’t worry if you don’t get it — just put this chapter aside for a few months, and come back when you want to stretch your brain.</p>
<div id="prerequisites-17" class="section level3" number="25.1.1">
<h3><span class="header-section-number">25.1.1</span> Prerequisites</h3>
<p>Working with many models requires many of the packages of the tidyverse (for data exploration, wrangling, and programming) and modelr to facilitate modelling.</p>
<div class="sourceCode" id="cb692"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb692-1"><a href="many-models.html#cb692-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(modelr)</span>
<span id="cb692-2"><a href="many-models.html#cb692-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code></pre></div>
</div>
</div>
<div id="gapminder" class="section level2" number="25.2">
<h2><span class="header-section-number">25.2</span> gapminder</h2>
<p>To motivate the power of many simple models, we’re going to look into the “gapminder” data. This data was popularised by Hans Rosling, a Swedish doctor and statistician. If you’ve never heard of him, stop reading this chapter right now and go watch one of his videos! He is a fantastic data presenter and illustrates how you can use data to present a compelling story. A good place to start is this short video filmed in conjunction with the BBC: <a href="https://www.youtube.com/watch?v=jbkSRLYSojo" class="uri">https://www.youtube.com/watch?v=jbkSRLYSojo</a>.</p>
<p>The gapminder data summarises the progression of countries over time, looking at statistics like life expectancy and GDP. The data is easy to access in R, thanks to Jenny Bryan who created the gapminder package:</p>
<div class="sourceCode" id="cb693"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb693-1"><a href="many-models.html#cb693-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gapminder)</span>
<span id="cb693-2"><a href="many-models.html#cb693-2" aria-hidden="true" tabindex="-1"></a>gapminder</span>
<span id="cb693-3"><a href="many-models.html#cb693-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1,704 x 6</span></span>
<span id="cb693-4"><a href="many-models.html#cb693-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   country     continent  year lifeExp      pop gdpPercap</span></span>
<span id="cb693-5"><a href="many-models.html#cb693-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;fct&gt;       &lt;fct&gt;     &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb693-6"><a href="many-models.html#cb693-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Afghanistan Asia       1952    28.8  8425333      779.</span></span>
<span id="cb693-7"><a href="many-models.html#cb693-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Afghanistan Asia       1957    30.3  9240934      821.</span></span>
<span id="cb693-8"><a href="many-models.html#cb693-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Afghanistan Asia       1962    32.0 10267083      853.</span></span>
<span id="cb693-9"><a href="many-models.html#cb693-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Afghanistan Asia       1967    34.0 11537966      836.</span></span>
<span id="cb693-10"><a href="many-models.html#cb693-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 Afghanistan Asia       1972    36.1 13079460      740.</span></span>
<span id="cb693-11"><a href="many-models.html#cb693-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 Afghanistan Asia       1977    38.4 14880372      786.</span></span>
<span id="cb693-12"><a href="many-models.html#cb693-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 1,698 more rows</span></span></code></pre></div>
<p>In this case study, we’re going to focus on just three variables to answer the question “How does life expectancy (<code>lifeExp</code>) change over time (<code>year</code>) for each country (<code>country</code>)?”. A good place to start is with a plot:</p>
<div class="sourceCode" id="cb694"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb694-1"><a href="many-models.html#cb694-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb694-2"><a href="many-models.html#cb694-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, lifeExp, <span class="at">group =</span> country)) <span class="sc">+</span></span>
<span id="cb694-3"><a href="many-models.html#cb694-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)</span></code></pre></div>
<p><img src="model-many_files/figure-html/unnamed-chunk-2-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>This is a small dataset: it only has ~1,700 observations and 3 variables. But it’s still hard to see what’s going on! Overall, it looks like life expectancy has been steadily improving. However, if you look closely, you might notice some countries that don’t follow this pattern. How can we make those countries easier to see?</p>
<p>One way is to use the same approach as in the last chapter: there’s a strong signal (overall linear growth) that makes it hard to see subtler trends. We’ll tease these factors apart by fitting a model with a linear trend. The model captures steady growth over time, and the residuals will show what’s left.</p>
<p>You already know how to do that if we had a single country:</p>
<div class="sourceCode" id="cb695"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb695-1"><a href="many-models.html#cb695-1" aria-hidden="true" tabindex="-1"></a>nz <span class="ot">&lt;-</span> <span class="fu">filter</span>(gapminder, country <span class="sc">==</span> <span class="st">&quot;New Zealand&quot;</span>)</span>
<span id="cb695-2"><a href="many-models.html#cb695-2" aria-hidden="true" tabindex="-1"></a>nz <span class="sc">%&gt;%</span> </span>
<span id="cb695-3"><a href="many-models.html#cb695-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, lifeExp)) <span class="sc">+</span> </span>
<span id="cb695-4"><a href="many-models.html#cb695-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb695-5"><a href="many-models.html#cb695-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Full data = &quot;</span>)</span>
<span id="cb695-6"><a href="many-models.html#cb695-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb695-7"><a href="many-models.html#cb695-7" aria-hidden="true" tabindex="-1"></a>nz_mod <span class="ot">&lt;-</span> <span class="fu">lm</span>(lifeExp <span class="sc">~</span> year, <span class="at">data =</span> nz)</span>
<span id="cb695-8"><a href="many-models.html#cb695-8" aria-hidden="true" tabindex="-1"></a>nz <span class="sc">%&gt;%</span> </span>
<span id="cb695-9"><a href="many-models.html#cb695-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_predictions</span>(nz_mod) <span class="sc">%&gt;%</span></span>
<span id="cb695-10"><a href="many-models.html#cb695-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, pred)) <span class="sc">+</span> </span>
<span id="cb695-11"><a href="many-models.html#cb695-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb695-12"><a href="many-models.html#cb695-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Linear trend + &quot;</span>)</span>
<span id="cb695-13"><a href="many-models.html#cb695-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb695-14"><a href="many-models.html#cb695-14" aria-hidden="true" tabindex="-1"></a>nz <span class="sc">%&gt;%</span> </span>
<span id="cb695-15"><a href="many-models.html#cb695-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_residuals</span>(nz_mod) <span class="sc">%&gt;%</span> </span>
<span id="cb695-16"><a href="many-models.html#cb695-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, resid)) <span class="sc">+</span> </span>
<span id="cb695-17"><a href="many-models.html#cb695-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">colour =</span> <span class="st">&quot;white&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb695-18"><a href="many-models.html#cb695-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> </span>
<span id="cb695-19"><a href="many-models.html#cb695-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Remaining pattern&quot;</span>)</span></code></pre></div>
<p><img src="model-many_files/figure-html/unnamed-chunk-3-1.png" width="33%" /><img src="model-many_files/figure-html/unnamed-chunk-3-2.png" width="33%" /><img src="model-many_files/figure-html/unnamed-chunk-3-3.png" width="33%" /></p>
<p>How can we easily fit that model to every country?</p>
<div id="nested-data" class="section level3" number="25.2.1">
<h3><span class="header-section-number">25.2.1</span> Nested data</h3>
<p>You could imagine copy and pasting that code multiple times; but you’ve already learned a better way! Extract out the common code with a function and repeat using a map function from purrr. This problem is structured a little differently to what you’ve seen before. Instead of repeating an action for each variable, we want to repeat an action for each country, a subset of rows. To do that, we need a new data structure: the <strong>nested data frame</strong>. To create a nested data frame we start with a grouped data frame, and “nest” it:</p>
<div class="sourceCode" id="cb696"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb696-1"><a href="many-models.html#cb696-1" aria-hidden="true" tabindex="-1"></a>by_country <span class="ot">&lt;-</span> gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb696-2"><a href="many-models.html#cb696-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country, continent) <span class="sc">%&gt;%</span> </span>
<span id="cb696-3"><a href="many-models.html#cb696-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>()</span>
<span id="cb696-4"><a href="many-models.html#cb696-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb696-5"><a href="many-models.html#cb696-5" aria-hidden="true" tabindex="-1"></a>by_country</span>
<span id="cb696-6"><a href="many-models.html#cb696-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 142 x 3</span></span>
<span id="cb696-7"><a href="many-models.html#cb696-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Groups:   country, continent [142]</span></span>
<span id="cb696-8"><a href="many-models.html#cb696-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   country     continent data             </span></span>
<span id="cb696-9"><a href="many-models.html#cb696-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;fct&gt;       &lt;fct&gt;     &lt;list&gt;           </span></span>
<span id="cb696-10"><a href="many-models.html#cb696-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Afghanistan Asia      &lt;tibble [12 × 4]&gt;</span></span>
<span id="cb696-11"><a href="many-models.html#cb696-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Albania     Europe    &lt;tibble [12 × 4]&gt;</span></span>
<span id="cb696-12"><a href="many-models.html#cb696-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Algeria     Africa    &lt;tibble [12 × 4]&gt;</span></span>
<span id="cb696-13"><a href="many-models.html#cb696-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Angola      Africa    &lt;tibble [12 × 4]&gt;</span></span>
<span id="cb696-14"><a href="many-models.html#cb696-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 Argentina   Americas  &lt;tibble [12 × 4]&gt;</span></span>
<span id="cb696-15"><a href="many-models.html#cb696-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 Australia   Oceania   &lt;tibble [12 × 4]&gt;</span></span>
<span id="cb696-16"><a href="many-models.html#cb696-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 136 more rows</span></span></code></pre></div>
<p>(I’m cheating a little by grouping on both <code>continent</code> and <code>country</code>. Given <code>country</code>, <code>continent</code> is fixed, so this doesn’t add any more groups, but it’s an easy way to carry an extra variable along for the ride.)</p>
<p>This creates a data frame that has one row per group (per country), and a rather unusual column: <code>data</code>. <code>data</code> is a list of data frames (or tibbles, to be precise). This seems like a crazy idea: we have a data frame with a column that is a list of other data frames! I’ll explain shortly why I think this is a good idea.</p>
<p>The <code>data</code> column is a little tricky to look at because it’s a moderately complicated list, and we’re still working on good tools to explore these objects. Unfortunately using <code>str()</code> is not recommended as it will often produce very long output. But if you pluck out a single element from the <code>data</code> column you’ll see that it contains all the data for that country (in this case, Afghanistan).</p>
<div class="sourceCode" id="cb697"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb697-1"><a href="many-models.html#cb697-1" aria-hidden="true" tabindex="-1"></a>by_country<span class="sc">$</span>data[[<span class="dv">1</span>]]</span>
<span id="cb697-2"><a href="many-models.html#cb697-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 12 x 4</span></span>
<span id="cb697-3"><a href="many-models.html#cb697-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    year lifeExp      pop gdpPercap</span></span>
<span id="cb697-4"><a href="many-models.html#cb697-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt;   &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;</span></span>
<span id="cb697-5"><a href="many-models.html#cb697-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  1952    28.8  8425333      779.</span></span>
<span id="cb697-6"><a href="many-models.html#cb697-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  1957    30.3  9240934      821.</span></span>
<span id="cb697-7"><a href="many-models.html#cb697-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3  1962    32.0 10267083      853.</span></span>
<span id="cb697-8"><a href="many-models.html#cb697-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4  1967    34.0 11537966      836.</span></span>
<span id="cb697-9"><a href="many-models.html#cb697-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5  1972    36.1 13079460      740.</span></span>
<span id="cb697-10"><a href="many-models.html#cb697-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6  1977    38.4 14880372      786.</span></span>
<span id="cb697-11"><a href="many-models.html#cb697-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 6 more rows</span></span></code></pre></div>
<p>Note the difference between a standard grouped data frame and a nested data frame: in a grouped data frame, each row is an observation; in a nested data frame, each row is a group. Another way to think about a nested dataset is we now have a meta-observation: a row that represents the complete time course for a country, rather than a single point in time.</p>
</div>
<div id="list-columns" class="section level3" number="25.2.2">
<h3><span class="header-section-number">25.2.2</span> List-columns</h3>
<p>Now that we have our nested data frame, we’re in a good position to fit some models. We have a model-fitting function:</p>
<div class="sourceCode" id="cb698"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb698-1"><a href="many-models.html#cb698-1" aria-hidden="true" tabindex="-1"></a>country_model <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb698-2"><a href="many-models.html#cb698-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">lm</span>(lifeExp <span class="sc">~</span> year, <span class="at">data =</span> df)</span>
<span id="cb698-3"><a href="many-models.html#cb698-3" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>And we want to apply it to every data frame. The data frames are in a list, so we can use <code>purrr::map()</code> to apply <code>country_model</code> to each element:</p>
<div class="sourceCode" id="cb699"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb699-1"><a href="many-models.html#cb699-1" aria-hidden="true" tabindex="-1"></a>models <span class="ot">&lt;-</span> <span class="fu">map</span>(by_country<span class="sc">$</span>data, country_model)</span></code></pre></div>
<p>However, rather than leaving the list of models as a free-floating object, I think it’s better to store it as a column in the <code>by_country</code> data frame. Storing related objects in columns is a key part of the value of data frames, and why I think list-columns are such a good idea. In the course of working with these countries, we are going to have lots of lists where we have one element per country. So why not store them all together in one data frame?</p>
<p>In other words, instead of creating a new object in the global environment, we’re going to create a new variable in the <code>by_country</code> data frame. That’s a job for <code>dplyr::mutate()</code>:</p>
<div class="sourceCode" id="cb700"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb700-1"><a href="many-models.html#cb700-1" aria-hidden="true" tabindex="-1"></a>by_country <span class="ot">&lt;-</span> by_country <span class="sc">%&gt;%</span> </span>
<span id="cb700-2"><a href="many-models.html#cb700-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">model =</span> <span class="fu">map</span>(data, country_model))</span>
<span id="cb700-3"><a href="many-models.html#cb700-3" aria-hidden="true" tabindex="-1"></a>by_country</span>
<span id="cb700-4"><a href="many-models.html#cb700-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 142 x 4</span></span>
<span id="cb700-5"><a href="many-models.html#cb700-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Groups:   country, continent [142]</span></span>
<span id="cb700-6"><a href="many-models.html#cb700-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   country     continent data              model </span></span>
<span id="cb700-7"><a href="many-models.html#cb700-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;fct&gt;       &lt;fct&gt;     &lt;list&gt;            &lt;list&gt;</span></span>
<span id="cb700-8"><a href="many-models.html#cb700-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Afghanistan Asia      &lt;tibble [12 × 4]&gt; &lt;lm&gt;  </span></span>
<span id="cb700-9"><a href="many-models.html#cb700-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Albania     Europe    &lt;tibble [12 × 4]&gt; &lt;lm&gt;  </span></span>
<span id="cb700-10"><a href="many-models.html#cb700-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Algeria     Africa    &lt;tibble [12 × 4]&gt; &lt;lm&gt;  </span></span>
<span id="cb700-11"><a href="many-models.html#cb700-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Angola      Africa    &lt;tibble [12 × 4]&gt; &lt;lm&gt;  </span></span>
<span id="cb700-12"><a href="many-models.html#cb700-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 Argentina   Americas  &lt;tibble [12 × 4]&gt; &lt;lm&gt;  </span></span>
<span id="cb700-13"><a href="many-models.html#cb700-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 Australia   Oceania   &lt;tibble [12 × 4]&gt; &lt;lm&gt;  </span></span>
<span id="cb700-14"><a href="many-models.html#cb700-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 136 more rows</span></span></code></pre></div>
<p>This has a big advantage: because all the related objects are stored together, you don’t need to manually keep them in sync when you filter or arrange. The semantics of the data frame takes care of that for you:</p>
<div class="sourceCode" id="cb701"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb701-1"><a href="many-models.html#cb701-1" aria-hidden="true" tabindex="-1"></a>by_country <span class="sc">%&gt;%</span> </span>
<span id="cb701-2"><a href="many-models.html#cb701-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(continent <span class="sc">==</span> <span class="st">&quot;Europe&quot;</span>)</span>
<span id="cb701-3"><a href="many-models.html#cb701-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 30 x 4</span></span>
<span id="cb701-4"><a href="many-models.html#cb701-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Groups:   country, continent [30]</span></span>
<span id="cb701-5"><a href="many-models.html#cb701-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   country                continent data              model </span></span>
<span id="cb701-6"><a href="many-models.html#cb701-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;fct&gt;                  &lt;fct&gt;     &lt;list&gt;            &lt;list&gt;</span></span>
<span id="cb701-7"><a href="many-models.html#cb701-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Albania                Europe    &lt;tibble [12 × 4]&gt; &lt;lm&gt;  </span></span>
<span id="cb701-8"><a href="many-models.html#cb701-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Austria                Europe    &lt;tibble [12 × 4]&gt; &lt;lm&gt;  </span></span>
<span id="cb701-9"><a href="many-models.html#cb701-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Belgium                Europe    &lt;tibble [12 × 4]&gt; &lt;lm&gt;  </span></span>
<span id="cb701-10"><a href="many-models.html#cb701-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Bosnia and Herzegovina Europe    &lt;tibble [12 × 4]&gt; &lt;lm&gt;  </span></span>
<span id="cb701-11"><a href="many-models.html#cb701-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 Bulgaria               Europe    &lt;tibble [12 × 4]&gt; &lt;lm&gt;  </span></span>
<span id="cb701-12"><a href="many-models.html#cb701-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 Croatia                Europe    &lt;tibble [12 × 4]&gt; &lt;lm&gt;  </span></span>
<span id="cb701-13"><a href="many-models.html#cb701-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 24 more rows</span></span>
<span id="cb701-14"><a href="many-models.html#cb701-14" aria-hidden="true" tabindex="-1"></a>by_country <span class="sc">%&gt;%</span> </span>
<span id="cb701-15"><a href="many-models.html#cb701-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(continent, country)</span>
<span id="cb701-16"><a href="many-models.html#cb701-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 142 x 4</span></span>
<span id="cb701-17"><a href="many-models.html#cb701-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Groups:   country, continent [142]</span></span>
<span id="cb701-18"><a href="many-models.html#cb701-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   country      continent data              model </span></span>
<span id="cb701-19"><a href="many-models.html#cb701-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;fct&gt;        &lt;fct&gt;     &lt;list&gt;            &lt;list&gt;</span></span>
<span id="cb701-20"><a href="many-models.html#cb701-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Algeria      Africa    &lt;tibble [12 × 4]&gt; &lt;lm&gt;  </span></span>
<span id="cb701-21"><a href="many-models.html#cb701-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Angola       Africa    &lt;tibble [12 × 4]&gt; &lt;lm&gt;  </span></span>
<span id="cb701-22"><a href="many-models.html#cb701-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Benin        Africa    &lt;tibble [12 × 4]&gt; &lt;lm&gt;  </span></span>
<span id="cb701-23"><a href="many-models.html#cb701-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Botswana     Africa    &lt;tibble [12 × 4]&gt; &lt;lm&gt;  </span></span>
<span id="cb701-24"><a href="many-models.html#cb701-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 Burkina Faso Africa    &lt;tibble [12 × 4]&gt; &lt;lm&gt;  </span></span>
<span id="cb701-25"><a href="many-models.html#cb701-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 Burundi      Africa    &lt;tibble [12 × 4]&gt; &lt;lm&gt;  </span></span>
<span id="cb701-26"><a href="many-models.html#cb701-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 136 more rows</span></span></code></pre></div>
<p>If your list of data frames and list of models were separate objects, you have to remember that whenever you re-order or subset one vector, you need to re-order or subset all the others in order to keep them in sync. If you forget, your code will continue to work, but it will give the wrong answer!</p>
</div>
<div id="unnesting" class="section level3" number="25.2.3">
<h3><span class="header-section-number">25.2.3</span> Unnesting</h3>
<p>Previously we computed the residuals of a single model with a single dataset. Now we have 142 data frames and 142 models. To compute the residuals, we need to call <code>add_residuals()</code> with each model-data pair:</p>
<div class="sourceCode" id="cb702"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb702-1"><a href="many-models.html#cb702-1" aria-hidden="true" tabindex="-1"></a>by_country <span class="ot">&lt;-</span> by_country <span class="sc">%&gt;%</span> </span>
<span id="cb702-2"><a href="many-models.html#cb702-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb702-3"><a href="many-models.html#cb702-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">resids =</span> <span class="fu">map2</span>(data, model, add_residuals)</span>
<span id="cb702-4"><a href="many-models.html#cb702-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb702-5"><a href="many-models.html#cb702-5" aria-hidden="true" tabindex="-1"></a>by_country</span>
<span id="cb702-6"><a href="many-models.html#cb702-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 142 x 5</span></span>
<span id="cb702-7"><a href="many-models.html#cb702-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Groups:   country, continent [142]</span></span>
<span id="cb702-8"><a href="many-models.html#cb702-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   country     continent data              model  resids           </span></span>
<span id="cb702-9"><a href="many-models.html#cb702-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;fct&gt;       &lt;fct&gt;     &lt;list&gt;            &lt;list&gt; &lt;list&gt;           </span></span>
<span id="cb702-10"><a href="many-models.html#cb702-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Afghanistan Asia      &lt;tibble [12 × 4]&gt; &lt;lm&gt;   &lt;tibble [12 × 5]&gt;</span></span>
<span id="cb702-11"><a href="many-models.html#cb702-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Albania     Europe    &lt;tibble [12 × 4]&gt; &lt;lm&gt;   &lt;tibble [12 × 5]&gt;</span></span>
<span id="cb702-12"><a href="many-models.html#cb702-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Algeria     Africa    &lt;tibble [12 × 4]&gt; &lt;lm&gt;   &lt;tibble [12 × 5]&gt;</span></span>
<span id="cb702-13"><a href="many-models.html#cb702-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Angola      Africa    &lt;tibble [12 × 4]&gt; &lt;lm&gt;   &lt;tibble [12 × 5]&gt;</span></span>
<span id="cb702-14"><a href="many-models.html#cb702-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 Argentina   Americas  &lt;tibble [12 × 4]&gt; &lt;lm&gt;   &lt;tibble [12 × 5]&gt;</span></span>
<span id="cb702-15"><a href="many-models.html#cb702-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 Australia   Oceania   &lt;tibble [12 × 4]&gt; &lt;lm&gt;   &lt;tibble [12 × 5]&gt;</span></span>
<span id="cb702-16"><a href="many-models.html#cb702-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 136 more rows</span></span></code></pre></div>
<p>But how can you plot a list of data frames? Instead of struggling to answer that question, let’s turn the list of data frames back into a regular data frame. Previously we used <code>nest()</code> to turn a regular data frame into an nested data frame, and now we do the opposite with <code>unnest()</code>:</p>
<div class="sourceCode" id="cb703"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb703-1"><a href="many-models.html#cb703-1" aria-hidden="true" tabindex="-1"></a>resids <span class="ot">&lt;-</span> <span class="fu">unnest</span>(by_country, resids)</span>
<span id="cb703-2"><a href="many-models.html#cb703-2" aria-hidden="true" tabindex="-1"></a>resids</span>
<span id="cb703-3"><a href="many-models.html#cb703-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1,704 x 9</span></span>
<span id="cb703-4"><a href="many-models.html#cb703-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Groups:   country, continent [142]</span></span>
<span id="cb703-5"><a href="many-models.html#cb703-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   country    continent data        model  year lifeExp     pop gdpPercap   resid</span></span>
<span id="cb703-6"><a href="many-models.html#cb703-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;fct&gt;      &lt;fct&gt;     &lt;list&gt;      &lt;lis&gt; &lt;int&gt;   &lt;dbl&gt;   &lt;int&gt;     &lt;dbl&gt;   &lt;dbl&gt;</span></span>
<span id="cb703-7"><a href="many-models.html#cb703-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Afghanist… Asia      &lt;tibble [1… &lt;lm&gt;   1952    28.8  8.43e6      779. -1.11  </span></span>
<span id="cb703-8"><a href="many-models.html#cb703-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Afghanist… Asia      &lt;tibble [1… &lt;lm&gt;   1957    30.3  9.24e6      821. -0.952 </span></span>
<span id="cb703-9"><a href="many-models.html#cb703-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Afghanist… Asia      &lt;tibble [1… &lt;lm&gt;   1962    32.0  1.03e7      853. -0.664 </span></span>
<span id="cb703-10"><a href="many-models.html#cb703-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Afghanist… Asia      &lt;tibble [1… &lt;lm&gt;   1967    34.0  1.15e7      836. -0.0172</span></span>
<span id="cb703-11"><a href="many-models.html#cb703-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 Afghanist… Asia      &lt;tibble [1… &lt;lm&gt;   1972    36.1  1.31e7      740.  0.674 </span></span>
<span id="cb703-12"><a href="many-models.html#cb703-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 Afghanist… Asia      &lt;tibble [1… &lt;lm&gt;   1977    38.4  1.49e7      786.  1.65  </span></span>
<span id="cb703-13"><a href="many-models.html#cb703-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 1,698 more rows</span></span></code></pre></div>
<p>Note that each regular column is repeated once for each row of the nested tibble.</p>
<p>Now we have regular data frame, we can plot the residuals:</p>
<div class="sourceCode" id="cb704"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb704-1"><a href="many-models.html#cb704-1" aria-hidden="true" tabindex="-1"></a>resids <span class="sc">%&gt;%</span> </span>
<span id="cb704-2"><a href="many-models.html#cb704-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, resid)) <span class="sc">+</span></span>
<span id="cb704-3"><a href="many-models.html#cb704-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group =</span> country), <span class="at">alpha =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb704-4"><a href="many-models.html#cb704-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">se =</span> <span class="cn">FALSE</span>)</span>
<span id="cb704-5"><a href="many-models.html#cb704-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `geom_smooth()` using method = &#39;gam&#39; and formula &#39;y ~ s(x, bs = &quot;cs&quot;)&#39;</span></span></code></pre></div>
<p><img src="model-many_files/figure-html/unnamed-chunk-12-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>Facetting by continent is particularly revealing:</p>
<div class="sourceCode" id="cb705"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb705-1"><a href="many-models.html#cb705-1" aria-hidden="true" tabindex="-1"></a>resids <span class="sc">%&gt;%</span> </span>
<span id="cb705-2"><a href="many-models.html#cb705-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, resid, <span class="at">group =</span> country)) <span class="sc">+</span></span>
<span id="cb705-3"><a href="many-models.html#cb705-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">alpha =</span> <span class="dv">1</span> <span class="sc">/</span> <span class="dv">3</span>) <span class="sc">+</span> </span>
<span id="cb705-4"><a href="many-models.html#cb705-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>continent)</span></code></pre></div>
<p><img src="model-many_files/figure-html/unnamed-chunk-13-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>It looks like we’ve missed some mild patterns. There’s also something interesting going on in Africa: we see some very large residuals which suggests our model isn’t fitting so well there. We’ll explore that more in the next section, attacking it from a slightly different angle.</p>
</div>
<div id="model-quality" class="section level3" number="25.2.4">
<h3><span class="header-section-number">25.2.4</span> Model quality</h3>
<p>Instead of looking at the residuals from the model, we could look at some general measurements of model quality. You learned how to compute some specific measures in the previous chapter. Here we’ll show a different approach using the broom package. The broom package provides a general set of functions to turn models into tidy data. Here we’ll use <code>broom::glance()</code> to extract some model quality metrics. If we apply it to a model, we get a data frame with a single row:</p>
<div class="sourceCode" id="cb706"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb706-1"><a href="many-models.html#cb706-1" aria-hidden="true" tabindex="-1"></a>broom<span class="sc">::</span><span class="fu">glance</span>(nz_mod)</span>
<span id="cb706-2"><a href="many-models.html#cb706-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 1 x 12</span></span>
<span id="cb706-3"><a href="many-models.html#cb706-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   r.squared adj.r.squared sigma statistic p.value    df logLik   AIC   BIC</span></span>
<span id="cb706-4"><a href="many-models.html#cb706-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb706-5"><a href="many-models.html#cb706-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     0.954         0.949 0.804      205. 5.41e-8     1  -13.3  32.6  34.1</span></span>
<span id="cb706-6"><a href="many-models.html#cb706-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 3 more variables: deviance &lt;dbl&gt;, df.residual &lt;int&gt;, nobs &lt;int&gt;</span></span></code></pre></div>
<p>We can use <code>mutate()</code> and <code>unnest()</code> to create a data frame with a row for each country:</p>
<div class="sourceCode" id="cb707"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb707-1"><a href="many-models.html#cb707-1" aria-hidden="true" tabindex="-1"></a>glance <span class="ot">&lt;-</span> by_country <span class="sc">%&gt;%</span> </span>
<span id="cb707-2"><a href="many-models.html#cb707-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">glance =</span> <span class="fu">map</span>(model, broom<span class="sc">::</span>glance)) <span class="sc">%&gt;%</span> </span>
<span id="cb707-3"><a href="many-models.html#cb707-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(country, continent, glance) <span class="sc">%&gt;%</span> </span>
<span id="cb707-4"><a href="many-models.html#cb707-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(glance)</span>
<span id="cb707-5"><a href="many-models.html#cb707-5" aria-hidden="true" tabindex="-1"></a>glance</span>
<span id="cb707-6"><a href="many-models.html#cb707-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 142 x 14</span></span>
<span id="cb707-7"><a href="many-models.html#cb707-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Groups:   country, continent [142]</span></span>
<span id="cb707-8"><a href="many-models.html#cb707-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   country continent r.squared adj.r.squared sigma statistic  p.value    df</span></span>
<span id="cb707-9"><a href="many-models.html#cb707-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;         &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb707-10"><a href="many-models.html#cb707-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Afghan… Asia          0.948         0.942 1.22      181.  9.84e- 8     1</span></span>
<span id="cb707-11"><a href="many-models.html#cb707-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Albania Europe        0.911         0.902 1.98      102.  1.46e- 6     1</span></span>
<span id="cb707-12"><a href="many-models.html#cb707-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Algeria Africa        0.985         0.984 1.32      662.  1.81e-10     1</span></span>
<span id="cb707-13"><a href="many-models.html#cb707-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Angola  Africa        0.888         0.877 1.41       79.1 4.59e- 6     1</span></span>
<span id="cb707-14"><a href="many-models.html#cb707-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 Argent… Americas      0.996         0.995 0.292    2246.  4.22e-13     1</span></span>
<span id="cb707-15"><a href="many-models.html#cb707-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 Austra… Oceania       0.980         0.978 0.621     481.  8.67e-10     1</span></span>
<span id="cb707-16"><a href="many-models.html#cb707-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 136 more rows, and 6 more variables: logLik &lt;dbl&gt;, AIC &lt;dbl&gt;,</span></span>
<span id="cb707-17"><a href="many-models.html#cb707-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   BIC &lt;dbl&gt;, deviance &lt;dbl&gt;, df.residual &lt;int&gt;, nobs &lt;int&gt;</span></span></code></pre></div>
<p>(Pay attention to the variables that aren’t printed: there’s a lot of useful stuff there.)</p>
<p>With this data frame in hand, we can start to look for models that don’t fit well:</p>
<div class="sourceCode" id="cb708"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb708-1"><a href="many-models.html#cb708-1" aria-hidden="true" tabindex="-1"></a>glance <span class="sc">%&gt;%</span> </span>
<span id="cb708-2"><a href="many-models.html#cb708-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(r.squared)</span>
<span id="cb708-3"><a href="many-models.html#cb708-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 142 x 14</span></span>
<span id="cb708-4"><a href="many-models.html#cb708-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Groups:   country, continent [142]</span></span>
<span id="cb708-5"><a href="many-models.html#cb708-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   country continent r.squared adj.r.squared sigma statistic p.value    df logLik</span></span>
<span id="cb708-6"><a href="many-models.html#cb708-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;fct&gt;   &lt;fct&gt;         &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;</span></span>
<span id="cb708-7"><a href="many-models.html#cb708-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Rwanda  Africa       0.0172      -0.0811   6.56     0.175   0.685     1  -38.5</span></span>
<span id="cb708-8"><a href="many-models.html#cb708-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Botswa… Africa       0.0340      -0.0626   6.11     0.352   0.566     1  -37.7</span></span>
<span id="cb708-9"><a href="many-models.html#cb708-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Zimbab… Africa       0.0562      -0.0381   7.21     0.596   0.458     1  -39.6</span></span>
<span id="cb708-10"><a href="many-models.html#cb708-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Zambia  Africa       0.0598      -0.0342   4.53     0.636   0.444     1  -34.1</span></span>
<span id="cb708-11"><a href="many-models.html#cb708-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 Swazil… Africa       0.0682      -0.0250   6.64     0.732   0.412     1  -38.7</span></span>
<span id="cb708-12"><a href="many-models.html#cb708-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 Lesotho Africa       0.0849      -0.00666  5.93     0.927   0.358     1  -37.3</span></span>
<span id="cb708-13"><a href="many-models.html#cb708-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 136 more rows, and 5 more variables: AIC &lt;dbl&gt;, BIC &lt;dbl&gt;,</span></span>
<span id="cb708-14"><a href="many-models.html#cb708-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; #   deviance &lt;dbl&gt;, df.residual &lt;int&gt;, nobs &lt;int&gt;</span></span></code></pre></div>
<p>The worst models all appear to be in Africa. Let’s double check that with a plot. Here we have a relatively small number of observations and a discrete variable, so <code>geom_jitter()</code> is effective:</p>
<div class="sourceCode" id="cb709"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb709-1"><a href="many-models.html#cb709-1" aria-hidden="true" tabindex="-1"></a>glance <span class="sc">%&gt;%</span> </span>
<span id="cb709-2"><a href="many-models.html#cb709-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(continent, r.squared)) <span class="sc">+</span> </span>
<span id="cb709-3"><a href="many-models.html#cb709-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_jitter</span>(<span class="at">width =</span> <span class="fl">0.5</span>)</span></code></pre></div>
<p><img src="model-many_files/figure-html/unnamed-chunk-17-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>We could pull out the countries with particularly bad <span class="math inline">\(R^2\)</span> and plot the data:</p>
<div class="sourceCode" id="cb710"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb710-1"><a href="many-models.html#cb710-1" aria-hidden="true" tabindex="-1"></a>bad_fit <span class="ot">&lt;-</span> <span class="fu">filter</span>(glance, r.squared <span class="sc">&lt;</span> <span class="fl">0.25</span>)</span>
<span id="cb710-2"><a href="many-models.html#cb710-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb710-3"><a href="many-models.html#cb710-3" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb710-4"><a href="many-models.html#cb710-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">semi_join</span>(bad_fit, <span class="at">by =</span> <span class="st">&quot;country&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb710-5"><a href="many-models.html#cb710-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(year, lifeExp, <span class="at">colour =</span> country)) <span class="sc">+</span></span>
<span id="cb710-6"><a href="many-models.html#cb710-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="model-many_files/figure-html/unnamed-chunk-18-1.png" width="70%" style="display: block; margin: auto;" /></p>
<p>We see two main effects here: the tragedies of the HIV/AIDS epidemic and the Rwandan genocide.</p>
</div>
<div id="exercises-68" class="section level3" number="25.2.5">
<h3><span class="header-section-number">25.2.5</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>A linear trend seems to be slightly too simple for the overall trend.
Can you do better with a quadratic polynomial? How can you interpret
the coefficients of the quadratic? (Hint you might want to transform
<code>year</code> so that it has mean zero.)</p></li>
<li><p>Explore other methods for visualising the distribution of <span class="math inline">\(R^2\)</span> per
continent. You might want to try the ggbeeswarm package, which provides
similar methods for avoiding overlaps as jitter, but uses deterministic
methods.</p></li>
<li><p>To create the last plot (showing the data for the countries with the
worst model fits), we needed two steps: we created a data frame with
one row per country and then semi-joined it to the original dataset.
It’s possible to avoid this join if we use <code>unnest()</code> instead of
<code>unnest(.drop = TRUE)</code>. How?</p></li>
</ol>
</div>
</div>
<div id="list-columns-1" class="section level2" number="25.3">
<h2><span class="header-section-number">25.3</span> List-columns</h2>
<p>Now that you’ve seen a basic workflow for managing many models, let’s dive back into some of the details. In this section, we’ll explore the list-column data structure in a little more detail. It’s only recently that I’ve really appreciated the idea of the list-column. List-columns are implicit in the definition of the data frame: a data frame is a named list of equal length vectors. A list is a vector, so it’s always been legitimate to use a list as a column of a data frame. However, base R doesn’t make it easy to create list-columns, and <code>data.frame()</code> treats a list as a list of columns:.</p>
<div class="sourceCode" id="cb711"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb711-1"><a href="many-models.html#cb711-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">x =</span> <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>))</span>
<span id="cb711-2"><a href="many-models.html#cb711-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   x.1.3 x.3.5</span></span>
<span id="cb711-3"><a href="many-models.html#cb711-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     1     3</span></span>
<span id="cb711-4"><a href="many-models.html#cb711-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     2     4</span></span>
<span id="cb711-5"><a href="many-models.html#cb711-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     3     5</span></span></code></pre></div>
<p>You can prevent <code>data.frame()</code> from doing this with <code>I()</code>, but the result doesn’t print particularly well:</p>
<div class="sourceCode" id="cb712"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb712-1"><a href="many-models.html#cb712-1" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(</span>
<span id="cb712-2"><a href="many-models.html#cb712-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">I</span>(<span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>)), </span>
<span id="cb712-3"><a href="many-models.html#cb712-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="st">&quot;1, 2&quot;</span>, <span class="st">&quot;3, 4, 5&quot;</span>)</span>
<span id="cb712-4"><a href="many-models.html#cb712-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb712-5"><a href="many-models.html#cb712-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         x       y</span></span>
<span id="cb712-6"><a href="many-models.html#cb712-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 1, 2, 3    1, 2</span></span>
<span id="cb712-7"><a href="many-models.html#cb712-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 3, 4, 5 3, 4, 5</span></span></code></pre></div>
<p>Tibble alleviates this problem by being lazier (<code>tibble()</code> doesn’t modify its inputs) and by providing a better print method:</p>
<div class="sourceCode" id="cb713"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb713-1"><a href="many-models.html#cb713-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb713-2"><a href="many-models.html#cb713-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">x =</span> <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>), </span>
<span id="cb713-3"><a href="many-models.html#cb713-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="fu">c</span>(<span class="st">&quot;1, 2&quot;</span>, <span class="st">&quot;3, 4, 5&quot;</span>)</span>
<span id="cb713-4"><a href="many-models.html#cb713-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb713-5"><a href="many-models.html#cb713-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 x 2</span></span>
<span id="cb713-6"><a href="many-models.html#cb713-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   x         y      </span></span>
<span id="cb713-7"><a href="many-models.html#cb713-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;list&gt;    &lt;chr&gt;  </span></span>
<span id="cb713-8"><a href="many-models.html#cb713-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 &lt;int [3]&gt; 1, 2   </span></span>
<span id="cb713-9"><a href="many-models.html#cb713-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 &lt;int [3]&gt; 3, 4, 5</span></span></code></pre></div>
<p>It’s even easier with <code>tribble()</code> as it can automatically work out that you need a list:</p>
<div class="sourceCode" id="cb714"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb714-1"><a href="many-models.html#cb714-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tribble</span>(</span>
<span id="cb714-2"><a href="many-models.html#cb714-2" aria-hidden="true" tabindex="-1"></a>   <span class="sc">~</span>x, <span class="sc">~</span>y,</span>
<span id="cb714-3"><a href="many-models.html#cb714-3" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="st">&quot;1, 2&quot;</span>,</span>
<span id="cb714-4"><a href="many-models.html#cb714-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">3</span><span class="sc">:</span><span class="dv">5</span>, <span class="st">&quot;3, 4, 5&quot;</span></span>
<span id="cb714-5"><a href="many-models.html#cb714-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb714-6"><a href="many-models.html#cb714-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 x 2</span></span>
<span id="cb714-7"><a href="many-models.html#cb714-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   x         y      </span></span>
<span id="cb714-8"><a href="many-models.html#cb714-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;list&gt;    &lt;chr&gt;  </span></span>
<span id="cb714-9"><a href="many-models.html#cb714-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 &lt;int [3]&gt; 1, 2   </span></span>
<span id="cb714-10"><a href="many-models.html#cb714-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 &lt;int [3]&gt; 3, 4, 5</span></span></code></pre></div>
<p>List-columns are often most useful as intermediate data structure. They’re hard to work with directly, because most R functions work with atomic vectors or data frames, but the advantage of keeping related items together in a data frame is worth a little hassle.</p>
<p>Generally there are three parts of an effective list-column pipeline:</p>
<ol style="list-style-type: decimal">
<li><p>You create the list-column using one of <code>nest()</code>, <code>summarise()</code> + <code>list()</code>,
or <code>mutate()</code> + a map function, as described in <a href="many-models.html#creating-list-columns">Creating list-columns</a>.</p></li>
<li><p>You create other intermediate list-columns by transforming existing
list columns with <code>map()</code>, <code>map2()</code> or <code>pmap()</code>. For example,
in the case study above, we created a list-column of models by transforming
a list-column of data frames.</p></li>
<li><p>You simplify the list-column back down to a data frame or atomic vector,
as described in <a href="many-models.html#simplifying-list-columns">Simplifying list-columns</a>.</p></li>
</ol>
</div>
<div id="creating-list-columns" class="section level2" number="25.4">
<h2><span class="header-section-number">25.4</span> Creating list-columns</h2>
<p>Typically, you won’t create list-columns with <code>tibble()</code>. Instead, you’ll create them from regular columns, using one of three methods:</p>
<ol style="list-style-type: decimal">
<li><p>With <code>tidyr::nest()</code> to convert a grouped data frame into a nested data
frame where you have list-column of data frames.</p></li>
<li><p>With <code>mutate()</code> and vectorised functions that return a list.</p></li>
<li><p>With <code>summarise()</code> and summary functions that return multiple results.</p></li>
</ol>
<p>Alternatively, you might create them from a named list, using <code>tibble::enframe()</code>.</p>
<p>Generally, when creating list-columns, you should make sure they’re homogeneous: each element should contain the same type of thing. There are no checks to make sure this is true, but if you use purrr and remember what you’ve learned about type-stable functions, you should find it happens naturally.</p>
<div id="with-nesting" class="section level3" number="25.4.1">
<h3><span class="header-section-number">25.4.1</span> With nesting</h3>
<p><code>nest()</code> creates a nested data frame, which is a data frame with a list-column of data frames. In a nested data frame each row is a meta-observation: the other columns give variables that define the observation (like country and continent above), and the list-column of data frames gives the individual observations that make up the meta-observation.</p>
<p>There are two ways to use <code>nest()</code>. So far you’ve seen how to use it with a grouped data frame. When applied to a grouped data frame, <code>nest()</code> keeps the grouping columns as is, and bundles everything else into the list-column:</p>
<div class="sourceCode" id="cb715"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb715-1"><a href="many-models.html#cb715-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb715-2"><a href="many-models.html#cb715-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(country, continent) <span class="sc">%&gt;%</span> </span>
<span id="cb715-3"><a href="many-models.html#cb715-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>()</span>
<span id="cb715-4"><a href="many-models.html#cb715-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 142 x 3</span></span>
<span id="cb715-5"><a href="many-models.html#cb715-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Groups:   country, continent [142]</span></span>
<span id="cb715-6"><a href="many-models.html#cb715-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   country     continent data             </span></span>
<span id="cb715-7"><a href="many-models.html#cb715-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;fct&gt;       &lt;fct&gt;     &lt;list&gt;           </span></span>
<span id="cb715-8"><a href="many-models.html#cb715-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Afghanistan Asia      &lt;tibble [12 × 4]&gt;</span></span>
<span id="cb715-9"><a href="many-models.html#cb715-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Albania     Europe    &lt;tibble [12 × 4]&gt;</span></span>
<span id="cb715-10"><a href="many-models.html#cb715-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Algeria     Africa    &lt;tibble [12 × 4]&gt;</span></span>
<span id="cb715-11"><a href="many-models.html#cb715-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Angola      Africa    &lt;tibble [12 × 4]&gt;</span></span>
<span id="cb715-12"><a href="many-models.html#cb715-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 Argentina   Americas  &lt;tibble [12 × 4]&gt;</span></span>
<span id="cb715-13"><a href="many-models.html#cb715-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 Australia   Oceania   &lt;tibble [12 × 4]&gt;</span></span>
<span id="cb715-14"><a href="many-models.html#cb715-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 136 more rows</span></span></code></pre></div>
<p>You can also use it on an ungrouped data frame, specifying which columns you want to nest:</p>
<div class="sourceCode" id="cb716"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb716-1"><a href="many-models.html#cb716-1" aria-hidden="true" tabindex="-1"></a>gapminder <span class="sc">%&gt;%</span> </span>
<span id="cb716-2"><a href="many-models.html#cb716-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">nest</span>(<span class="at">data =</span> <span class="fu">c</span>(year<span class="sc">:</span>gdpPercap))</span>
<span id="cb716-3"><a href="many-models.html#cb716-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 142 x 3</span></span>
<span id="cb716-4"><a href="many-models.html#cb716-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   country     continent data             </span></span>
<span id="cb716-5"><a href="many-models.html#cb716-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;fct&gt;       &lt;fct&gt;     &lt;list&gt;           </span></span>
<span id="cb716-6"><a href="many-models.html#cb716-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Afghanistan Asia      &lt;tibble [12 × 4]&gt;</span></span>
<span id="cb716-7"><a href="many-models.html#cb716-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Albania     Europe    &lt;tibble [12 × 4]&gt;</span></span>
<span id="cb716-8"><a href="many-models.html#cb716-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Algeria     Africa    &lt;tibble [12 × 4]&gt;</span></span>
<span id="cb716-9"><a href="many-models.html#cb716-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Angola      Africa    &lt;tibble [12 × 4]&gt;</span></span>
<span id="cb716-10"><a href="many-models.html#cb716-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 Argentina   Americas  &lt;tibble [12 × 4]&gt;</span></span>
<span id="cb716-11"><a href="many-models.html#cb716-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 Australia   Oceania   &lt;tibble [12 × 4]&gt;</span></span>
<span id="cb716-12"><a href="many-models.html#cb716-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 136 more rows</span></span></code></pre></div>
</div>
<div id="from-vectorised-functions" class="section level3" number="25.4.2">
<h3><span class="header-section-number">25.4.2</span> From vectorised functions</h3>
<p>Some useful functions take an atomic vector and return a list. For example, in <a href="strings.html#strings">strings</a> you learned about <code>stringr::str_split()</code> which takes a character vector and returns a list of character vectors. If you use that inside mutate, you’ll get a list-column:</p>
<div class="sourceCode" id="cb717"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb717-1"><a href="many-models.html#cb717-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb717-2"><a href="many-models.html#cb717-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>x1,</span>
<span id="cb717-3"><a href="many-models.html#cb717-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;a,b,c&quot;</span>, </span>
<span id="cb717-4"><a href="many-models.html#cb717-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;d,e,f,g&quot;</span></span>
<span id="cb717-5"><a href="many-models.html#cb717-5" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb717-6"><a href="many-models.html#cb717-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb717-7"><a href="many-models.html#cb717-7" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb717-8"><a href="many-models.html#cb717-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x2 =</span> stringr<span class="sc">::</span><span class="fu">str_split</span>(x1, <span class="st">&quot;,&quot;</span>))</span>
<span id="cb717-9"><a href="many-models.html#cb717-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 x 2</span></span>
<span id="cb717-10"><a href="many-models.html#cb717-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   x1      x2       </span></span>
<span id="cb717-11"><a href="many-models.html#cb717-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;   &lt;list&gt;   </span></span>
<span id="cb717-12"><a href="many-models.html#cb717-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 a,b,c   &lt;chr [3]&gt;</span></span>
<span id="cb717-13"><a href="many-models.html#cb717-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 d,e,f,g &lt;chr [4]&gt;</span></span></code></pre></div>
<p><code>unnest()</code> knows how to handle these lists of vectors:</p>
<div class="sourceCode" id="cb718"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb718-1"><a href="many-models.html#cb718-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb718-2"><a href="many-models.html#cb718-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">x2 =</span> stringr<span class="sc">::</span><span class="fu">str_split</span>(x1, <span class="st">&quot;,&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb718-3"><a href="many-models.html#cb718-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(x2)</span>
<span id="cb718-4"><a href="many-models.html#cb718-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 7 x 2</span></span>
<span id="cb718-5"><a href="many-models.html#cb718-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   x1      x2   </span></span>
<span id="cb718-6"><a href="many-models.html#cb718-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt;</span></span>
<span id="cb718-7"><a href="many-models.html#cb718-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 a,b,c   a    </span></span>
<span id="cb718-8"><a href="many-models.html#cb718-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 a,b,c   b    </span></span>
<span id="cb718-9"><a href="many-models.html#cb718-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 a,b,c   c    </span></span>
<span id="cb718-10"><a href="many-models.html#cb718-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 d,e,f,g d    </span></span>
<span id="cb718-11"><a href="many-models.html#cb718-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5 d,e,f,g e    </span></span>
<span id="cb718-12"><a href="many-models.html#cb718-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 d,e,f,g f    </span></span>
<span id="cb718-13"><a href="many-models.html#cb718-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 1 more row</span></span></code></pre></div>
<p>(If you find yourself using this pattern a lot, make sure to check out <code>tidyr::separate_rows()</code> which is a wrapper around this common pattern).</p>
<p>Another example of this pattern is using the <code>map()</code>, <code>map2()</code>, <code>pmap()</code> from purrr. For example, we could take the final example from <a href="iteration.html#invoking-different-functions">Invoking different functions</a> and rewrite it to use <code>mutate()</code>:</p>
<div class="sourceCode" id="cb719"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb719-1"><a href="many-models.html#cb719-1" aria-hidden="true" tabindex="-1"></a>sim <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb719-2"><a href="many-models.html#cb719-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>f,      <span class="sc">~</span>params,</span>
<span id="cb719-3"><a href="many-models.html#cb719-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;runif&quot;</span>, <span class="fu">list</span>(<span class="at">min =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">max =</span> <span class="dv">1</span>),</span>
<span id="cb719-4"><a href="many-models.html#cb719-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;rnorm&quot;</span>, <span class="fu">list</span>(<span class="at">sd =</span> <span class="dv">5</span>),</span>
<span id="cb719-5"><a href="many-models.html#cb719-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;rpois&quot;</span>, <span class="fu">list</span>(<span class="at">lambda =</span> <span class="dv">10</span>)</span>
<span id="cb719-6"><a href="many-models.html#cb719-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb719-7"><a href="many-models.html#cb719-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb719-8"><a href="many-models.html#cb719-8" aria-hidden="true" tabindex="-1"></a>sim <span class="sc">%&gt;%</span></span>
<span id="cb719-9"><a href="many-models.html#cb719-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">sims =</span> <span class="fu">invoke_map</span>(f, params, <span class="at">n =</span> <span class="dv">10</span>))</span>
<span id="cb719-10"><a href="many-models.html#cb719-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 x 3</span></span>
<span id="cb719-11"><a href="many-models.html#cb719-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   f     params           sims      </span></span>
<span id="cb719-12"><a href="many-models.html#cb719-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;list&gt;           &lt;list&gt;    </span></span>
<span id="cb719-13"><a href="many-models.html#cb719-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 runif &lt;named list [2]&gt; &lt;dbl [10]&gt;</span></span>
<span id="cb719-14"><a href="many-models.html#cb719-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 rnorm &lt;named list [1]&gt; &lt;dbl [10]&gt;</span></span>
<span id="cb719-15"><a href="many-models.html#cb719-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 rpois &lt;named list [1]&gt; &lt;int [10]&gt;</span></span></code></pre></div>
<p>Note that technically <code>sim</code> isn’t homogeneous because it contains both double and integer vectors. However, this is unlikely to cause many problems since integers and doubles are both numeric vectors.</p>
</div>
<div id="from-multivalued-summaries" class="section level3" number="25.4.3">
<h3><span class="header-section-number">25.4.3</span> From multivalued summaries</h3>
<p>One restriction of <code>summarise()</code> is that it only works with summary functions that return a single value. That means that you can’t use it with functions like <code>quantile()</code> that return a vector of arbitrary length:</p>
<div class="sourceCode" id="cb720"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb720-1"><a href="many-models.html#cb720-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb720-2"><a href="many-models.html#cb720-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span> </span>
<span id="cb720-3"><a href="many-models.html#cb720-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">q =</span> <span class="fu">quantile</span>(mpg))</span>
<span id="cb720-4"><a href="many-models.html#cb720-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `summarise()` has grouped output by &#39;cyl&#39;. You can override using the `.groups` argument.</span></span>
<span id="cb720-5"><a href="many-models.html#cb720-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 15 x 2</span></span>
<span id="cb720-6"><a href="many-models.html#cb720-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # Groups:   cyl [3]</span></span>
<span id="cb720-7"><a href="many-models.html#cb720-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     cyl     q</span></span>
<span id="cb720-8"><a href="many-models.html#cb720-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb720-9"><a href="many-models.html#cb720-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     4  21.4</span></span>
<span id="cb720-10"><a href="many-models.html#cb720-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     4  22.8</span></span>
<span id="cb720-11"><a href="many-models.html#cb720-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     4  26  </span></span>
<span id="cb720-12"><a href="many-models.html#cb720-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     4  30.4</span></span>
<span id="cb720-13"><a href="many-models.html#cb720-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5     4  33.9</span></span>
<span id="cb720-14"><a href="many-models.html#cb720-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6     6  17.8</span></span>
<span id="cb720-15"><a href="many-models.html#cb720-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 9 more rows</span></span></code></pre></div>
<p>You can however, wrap the result in a list! This obeys the contract of <code>summarise()</code>, because each summary is now a list (a vector) of length 1.</p>
<div class="sourceCode" id="cb721"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb721-1"><a href="many-models.html#cb721-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb721-2"><a href="many-models.html#cb721-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span> </span>
<span id="cb721-3"><a href="many-models.html#cb721-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">q =</span> <span class="fu">list</span>(<span class="fu">quantile</span>(mpg)))</span>
<span id="cb721-4"><a href="many-models.html#cb721-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 x 2</span></span>
<span id="cb721-5"><a href="many-models.html#cb721-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     cyl q        </span></span>
<span id="cb721-6"><a href="many-models.html#cb721-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; * &lt;dbl&gt; &lt;list&gt;   </span></span>
<span id="cb721-7"><a href="many-models.html#cb721-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     4 &lt;dbl [5]&gt;</span></span>
<span id="cb721-8"><a href="many-models.html#cb721-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     6 &lt;dbl [5]&gt;</span></span>
<span id="cb721-9"><a href="many-models.html#cb721-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     8 &lt;dbl [5]&gt;</span></span></code></pre></div>
<p>To make useful results with unnest, you’ll also need to capture the probabilities:</p>
<div class="sourceCode" id="cb722"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb722-1"><a href="many-models.html#cb722-1" aria-hidden="true" tabindex="-1"></a>probs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fl">0.01</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.75</span>, <span class="fl">0.99</span>)</span>
<span id="cb722-2"><a href="many-models.html#cb722-2" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb722-3"><a href="many-models.html#cb722-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span> </span>
<span id="cb722-4"><a href="many-models.html#cb722-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">p =</span> <span class="fu">list</span>(probs), <span class="at">q =</span> <span class="fu">list</span>(<span class="fu">quantile</span>(mpg, probs))) <span class="sc">%&gt;%</span> </span>
<span id="cb722-5"><a href="many-models.html#cb722-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="fu">c</span>(p, q))</span>
<span id="cb722-6"><a href="many-models.html#cb722-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 15 x 3</span></span>
<span id="cb722-7"><a href="many-models.html#cb722-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     cyl     p     q</span></span>
<span id="cb722-8"><a href="many-models.html#cb722-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb722-9"><a href="many-models.html#cb722-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     4  0.01  21.4</span></span>
<span id="cb722-10"><a href="many-models.html#cb722-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     4  0.25  22.8</span></span>
<span id="cb722-11"><a href="many-models.html#cb722-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     4  0.5   26  </span></span>
<span id="cb722-12"><a href="many-models.html#cb722-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     4  0.75  30.4</span></span>
<span id="cb722-13"><a href="many-models.html#cb722-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5     4  0.99  33.8</span></span>
<span id="cb722-14"><a href="many-models.html#cb722-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6     6  0.01  17.8</span></span>
<span id="cb722-15"><a href="many-models.html#cb722-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 9 more rows</span></span></code></pre></div>
</div>
<div id="from-a-named-list" class="section level3" number="25.4.4">
<h3><span class="header-section-number">25.4.4</span> From a named list</h3>
<p>Data frames with list-columns provide a solution to a common problem: what do you do if you want to iterate over both the contents of a list and its elements? Instead of trying to jam everything into one object, it’s often easier to make a data frame: one column can contain the elements, and one column can contain the list. An easy way to create such a data frame from a list is <code>tibble::enframe()</code>.</p>
<div class="sourceCode" id="cb723"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb723-1"><a href="many-models.html#cb723-1" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb723-2"><a href="many-models.html#cb723-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">a =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb723-3"><a href="many-models.html#cb723-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">b =</span> <span class="dv">3</span><span class="sc">:</span><span class="dv">4</span>, </span>
<span id="cb723-4"><a href="many-models.html#cb723-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">c =</span> <span class="dv">5</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb723-5"><a href="many-models.html#cb723-5" aria-hidden="true" tabindex="-1"></a>) </span>
<span id="cb723-6"><a href="many-models.html#cb723-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb723-7"><a href="many-models.html#cb723-7" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">enframe</span>(x)</span>
<span id="cb723-8"><a href="many-models.html#cb723-8" aria-hidden="true" tabindex="-1"></a>df</span>
<span id="cb723-9"><a href="many-models.html#cb723-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 x 2</span></span>
<span id="cb723-10"><a href="many-models.html#cb723-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   name  value    </span></span>
<span id="cb723-11"><a href="many-models.html#cb723-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;list&gt;   </span></span>
<span id="cb723-12"><a href="many-models.html#cb723-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 a     &lt;int [5]&gt;</span></span>
<span id="cb723-13"><a href="many-models.html#cb723-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 b     &lt;int [2]&gt;</span></span>
<span id="cb723-14"><a href="many-models.html#cb723-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 c     &lt;int [2]&gt;</span></span></code></pre></div>
<p>The advantage of this structure is that it generalises in a straightforward way - names are useful if you have character vector of metadata, but don’t help if you have other types of data, or multiple vectors.</p>
<p>Now if you want to iterate over names and values in parallel, you can use <code>map2()</code>:</p>
<div class="sourceCode" id="cb724"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb724-1"><a href="many-models.html#cb724-1" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> </span>
<span id="cb724-2"><a href="many-models.html#cb724-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb724-3"><a href="many-models.html#cb724-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">smry =</span> <span class="fu">map2_chr</span>(name, value, <span class="sc">~</span> stringr<span class="sc">::</span><span class="fu">str_c</span>(.x, <span class="st">&quot;: &quot;</span>, .y[<span class="dv">1</span>]))</span>
<span id="cb724-4"><a href="many-models.html#cb724-4" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb724-5"><a href="many-models.html#cb724-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 x 3</span></span>
<span id="cb724-6"><a href="many-models.html#cb724-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   name  value     smry </span></span>
<span id="cb724-7"><a href="many-models.html#cb724-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;chr&gt; &lt;list&gt;    &lt;chr&gt;</span></span>
<span id="cb724-8"><a href="many-models.html#cb724-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 a     &lt;int [5]&gt; a: 1 </span></span>
<span id="cb724-9"><a href="many-models.html#cb724-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 b     &lt;int [2]&gt; b: 3 </span></span>
<span id="cb724-10"><a href="many-models.html#cb724-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 c     &lt;int [2]&gt; c: 5</span></span></code></pre></div>
</div>
<div id="exercises-69" class="section level3" number="25.4.5">
<h3><span class="header-section-number">25.4.5</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>List all the functions that you can think of that take a atomic vector and
return a list.</p></li>
<li><p>Brainstorm useful summary functions that, like <code>quantile()</code>, return
multiple values.</p></li>
<li><p>What’s missing in the following data frame? How does <code>quantile()</code> return
that missing piece? Why isn’t that helpful here?</p>
<div class="sourceCode" id="cb725"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb725-1"><a href="many-models.html#cb725-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb725-2"><a href="many-models.html#cb725-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span> </span>
<span id="cb725-3"><a href="many-models.html#cb725-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">q =</span> <span class="fu">list</span>(<span class="fu">quantile</span>(mpg))) <span class="sc">%&gt;%</span> </span>
<span id="cb725-4"><a href="many-models.html#cb725-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unnest</span>(q)</span>
<span id="cb725-5"><a href="many-models.html#cb725-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 15 x 2</span></span>
<span id="cb725-6"><a href="many-models.html#cb725-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     cyl     q</span></span>
<span id="cb725-7"><a href="many-models.html#cb725-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb725-8"><a href="many-models.html#cb725-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     4  21.4</span></span>
<span id="cb725-9"><a href="many-models.html#cb725-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     4  22.8</span></span>
<span id="cb725-10"><a href="many-models.html#cb725-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     4  26  </span></span>
<span id="cb725-11"><a href="many-models.html#cb725-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     4  30.4</span></span>
<span id="cb725-12"><a href="many-models.html#cb725-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5     4  33.9</span></span>
<span id="cb725-13"><a href="many-models.html#cb725-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6     6  17.8</span></span>
<span id="cb725-14"><a href="many-models.html#cb725-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # … with 9 more rows</span></span></code></pre></div></li>
<li><p>What does this code do? Why might might it be useful?</p>
<div class="sourceCode" id="cb726"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb726-1"><a href="many-models.html#cb726-1" aria-hidden="true" tabindex="-1"></a>mtcars <span class="sc">%&gt;%</span> </span>
<span id="cb726-2"><a href="many-models.html#cb726-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cyl) <span class="sc">%&gt;%</span> </span>
<span id="cb726-3"><a href="many-models.html#cb726-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_all</span>(<span class="fu">list</span>(list))</span></code></pre></div></li>
</ol>
</div>
</div>
<div id="simplifying-list-columns" class="section level2" number="25.5">
<h2><span class="header-section-number">25.5</span> Simplifying list-columns</h2>
<p>To apply the techniques of data manipulation and visualisation you’ve learned in this book, you’ll need to simplify the list-column back to a regular column (an atomic vector), or set of columns. The technique you’ll use to collapse back down to a simpler structure depends on whether you want a single value per element, or multiple values:</p>
<ol style="list-style-type: decimal">
<li><p>If you want a single value, use <code>mutate()</code> with <code>map_lgl()</code>,
<code>map_int()</code>, <code>map_dbl()</code>, and <code>map_chr()</code> to create an atomic vector.</p></li>
<li><p>If you want many values, use <code>unnest()</code> to convert list-columns back
to regular columns, repeating the rows as many times as necessary.</p></li>
</ol>
<p>These are described in more detail below.</p>
<div id="list-to-vector" class="section level3" number="25.5.1">
<h3><span class="header-section-number">25.5.1</span> List to vector</h3>
<p>If you can reduce your list column to an atomic vector then it will be a regular column. For example, you can always summarise an object with its type and length, so this code will work regardless of what sort of list-column you have:</p>
<div class="sourceCode" id="cb727"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb727-1"><a href="many-models.html#cb727-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb727-2"><a href="many-models.html#cb727-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>x,</span>
<span id="cb727-3"><a href="many-models.html#cb727-3" aria-hidden="true" tabindex="-1"></a>  letters[<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>],</span>
<span id="cb727-4"><a href="many-models.html#cb727-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>,</span>
<span id="cb727-5"><a href="many-models.html#cb727-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">runif</span>(<span class="dv">5</span>)</span>
<span id="cb727-6"><a href="many-models.html#cb727-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb727-7"><a href="many-models.html#cb727-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb727-8"><a href="many-models.html#cb727-8" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb727-9"><a href="many-models.html#cb727-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">type =</span> <span class="fu">map_chr</span>(x, typeof),</span>
<span id="cb727-10"><a href="many-models.html#cb727-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">length =</span> <span class="fu">map_int</span>(x, length)</span>
<span id="cb727-11"><a href="many-models.html#cb727-11" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb727-12"><a href="many-models.html#cb727-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 x 3</span></span>
<span id="cb727-13"><a href="many-models.html#cb727-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   x         type      length</span></span>
<span id="cb727-14"><a href="many-models.html#cb727-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;list&gt;    &lt;chr&gt;      &lt;int&gt;</span></span>
<span id="cb727-15"><a href="many-models.html#cb727-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 &lt;chr [5]&gt; character      5</span></span>
<span id="cb727-16"><a href="many-models.html#cb727-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 &lt;int [3]&gt; integer        3</span></span>
<span id="cb727-17"><a href="many-models.html#cb727-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 &lt;dbl [5]&gt; double         5</span></span></code></pre></div>
<p>This is the same basic information that you get from the default tbl print method, but now you can use it for filtering. This is a useful technique if you have a heterogeneous list, and want to filter out the parts aren’t working for you.</p>
<p>Don’t forget about the <code>map_*()</code> shortcuts - you can use <code>map_chr(x, "apple")</code> to extract the string stored in <code>apple</code> for each element of <code>x</code>. This is useful for pulling apart nested lists into regular columns. Use the <code>.null</code> argument to provide a value to use if the element is missing (instead of returning <code>NULL</code>):</p>
<div class="sourceCode" id="cb728"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb728-1"><a href="many-models.html#cb728-1" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb728-2"><a href="many-models.html#cb728-2" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>x,</span>
<span id="cb728-3"><a href="many-models.html#cb728-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">a =</span> <span class="dv">1</span>, <span class="at">b =</span> <span class="dv">2</span>),</span>
<span id="cb728-4"><a href="many-models.html#cb728-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">list</span>(<span class="at">a =</span> <span class="dv">2</span>, <span class="at">c =</span> <span class="dv">4</span>)</span>
<span id="cb728-5"><a href="many-models.html#cb728-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb728-6"><a href="many-models.html#cb728-6" aria-hidden="true" tabindex="-1"></a>df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb728-7"><a href="many-models.html#cb728-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">a =</span> <span class="fu">map_dbl</span>(x, <span class="st">&quot;a&quot;</span>),</span>
<span id="cb728-8"><a href="many-models.html#cb728-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">b =</span> <span class="fu">map_dbl</span>(x, <span class="st">&quot;b&quot;</span>, <span class="at">.null =</span> <span class="cn">NA_real_</span>)</span>
<span id="cb728-9"><a href="many-models.html#cb728-9" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb728-10"><a href="many-models.html#cb728-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 x 3</span></span>
<span id="cb728-11"><a href="many-models.html#cb728-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   x                    a     b</span></span>
<span id="cb728-12"><a href="many-models.html#cb728-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;list&gt;           &lt;dbl&gt; &lt;dbl&gt;</span></span>
<span id="cb728-13"><a href="many-models.html#cb728-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 &lt;named list [2]&gt;     1     2</span></span>
<span id="cb728-14"><a href="many-models.html#cb728-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 &lt;named list [2]&gt;     2    NA</span></span></code></pre></div>
</div>
<div id="unnesting-1" class="section level3" number="25.5.2">
<h3><span class="header-section-number">25.5.2</span> Unnesting</h3>
<p><code>unnest()</code> works by repeating the regular columns once for each element of the list-column. For example, in the following very simple example we repeat the first row 4 times (because there the first element of <code>y</code> has length four), and the second row once:</p>
<div class="sourceCode" id="cb729"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb729-1"><a href="many-models.html#cb729-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(<span class="at">x =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">y =</span> <span class="fu">list</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="dv">1</span>)) <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(y)</span>
<span id="cb729-2"><a href="many-models.html#cb729-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 5 x 2</span></span>
<span id="cb729-3"><a href="many-models.html#cb729-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       x     y</span></span>
<span id="cb729-4"><a href="many-models.html#cb729-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;int&gt; &lt;dbl&gt;</span></span>
<span id="cb729-5"><a href="many-models.html#cb729-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     1     1</span></span>
<span id="cb729-6"><a href="many-models.html#cb729-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     1     2</span></span>
<span id="cb729-7"><a href="many-models.html#cb729-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     1     3</span></span>
<span id="cb729-8"><a href="many-models.html#cb729-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     1     4</span></span>
<span id="cb729-9"><a href="many-models.html#cb729-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5     2     1</span></span></code></pre></div>
<p>This means that you can’t simultaneously unnest two columns that contain different number of elements:</p>
<div class="sourceCode" id="cb730"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb730-1"><a href="many-models.html#cb730-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Ok, because y and z have the same number of elements in</span></span>
<span id="cb730-2"><a href="many-models.html#cb730-2" aria-hidden="true" tabindex="-1"></a><span class="co"># every row</span></span>
<span id="cb730-3"><a href="many-models.html#cb730-3" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb730-4"><a href="many-models.html#cb730-4" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>x, <span class="sc">~</span>y,           <span class="sc">~</span>z,</span>
<span id="cb730-5"><a href="many-models.html#cb730-5" aria-hidden="true" tabindex="-1"></a>   <span class="dv">1</span>, <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;b&quot;</span>), <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb730-6"><a href="many-models.html#cb730-6" aria-hidden="true" tabindex="-1"></a>   <span class="dv">2</span>, <span class="st">&quot;c&quot;</span>,           <span class="dv">3</span></span>
<span id="cb730-7"><a href="many-models.html#cb730-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb730-8"><a href="many-models.html#cb730-8" aria-hidden="true" tabindex="-1"></a>df1</span>
<span id="cb730-9"><a href="many-models.html#cb730-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 x 3</span></span>
<span id="cb730-10"><a href="many-models.html#cb730-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       x y         z        </span></span>
<span id="cb730-11"><a href="many-models.html#cb730-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;list&gt;    &lt;list&gt;   </span></span>
<span id="cb730-12"><a href="many-models.html#cb730-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     1 &lt;chr [2]&gt; &lt;int [2]&gt;</span></span>
<span id="cb730-13"><a href="many-models.html#cb730-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     2 &lt;chr [1]&gt; &lt;dbl [1]&gt;</span></span>
<span id="cb730-14"><a href="many-models.html#cb730-14" aria-hidden="true" tabindex="-1"></a>df1 <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(<span class="fu">c</span>(y, z))</span>
<span id="cb730-15"><a href="many-models.html#cb730-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 3 x 3</span></span>
<span id="cb730-16"><a href="many-models.html#cb730-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       x y         z</span></span>
<span id="cb730-17"><a href="many-models.html#cb730-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;</span></span>
<span id="cb730-18"><a href="many-models.html#cb730-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     1 a         1</span></span>
<span id="cb730-19"><a href="many-models.html#cb730-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     1 b         2</span></span>
<span id="cb730-20"><a href="many-models.html#cb730-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     2 c         3</span></span>
<span id="cb730-21"><a href="many-models.html#cb730-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb730-22"><a href="many-models.html#cb730-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Doesn&#39;t work because y and z have different number of elements</span></span>
<span id="cb730-23"><a href="many-models.html#cb730-23" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">tribble</span>(</span>
<span id="cb730-24"><a href="many-models.html#cb730-24" aria-hidden="true" tabindex="-1"></a>  <span class="sc">~</span>x, <span class="sc">~</span>y,           <span class="sc">~</span>z,</span>
<span id="cb730-25"><a href="many-models.html#cb730-25" aria-hidden="true" tabindex="-1"></a>   <span class="dv">1</span>, <span class="st">&quot;a&quot;</span>,         <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,  </span>
<span id="cb730-26"><a href="many-models.html#cb730-26" aria-hidden="true" tabindex="-1"></a>   <span class="dv">2</span>, <span class="fu">c</span>(<span class="st">&quot;b&quot;</span>, <span class="st">&quot;c&quot;</span>),   <span class="dv">3</span></span>
<span id="cb730-27"><a href="many-models.html#cb730-27" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb730-28"><a href="many-models.html#cb730-28" aria-hidden="true" tabindex="-1"></a>df2</span>
<span id="cb730-29"><a href="many-models.html#cb730-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 2 x 3</span></span>
<span id="cb730-30"><a href="many-models.html#cb730-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       x y         z        </span></span>
<span id="cb730-31"><a href="many-models.html#cb730-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;list&gt;    &lt;list&gt;   </span></span>
<span id="cb730-32"><a href="many-models.html#cb730-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     1 &lt;chr [1]&gt; &lt;int [2]&gt;</span></span>
<span id="cb730-33"><a href="many-models.html#cb730-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     2 &lt;chr [2]&gt; &lt;dbl [1]&gt;</span></span>
<span id="cb730-34"><a href="many-models.html#cb730-34" aria-hidden="true" tabindex="-1"></a>df2 <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(<span class="fu">c</span>(y, z))</span>
<span id="cb730-35"><a href="many-models.html#cb730-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; # A tibble: 4 x 3</span></span>
<span id="cb730-36"><a href="many-models.html#cb730-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       x y         z</span></span>
<span id="cb730-37"><a href="many-models.html#cb730-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;</span></span>
<span id="cb730-38"><a href="many-models.html#cb730-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1     1 a         1</span></span>
<span id="cb730-39"><a href="many-models.html#cb730-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2     1 a         2</span></span>
<span id="cb730-40"><a href="many-models.html#cb730-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3     2 b         3</span></span>
<span id="cb730-41"><a href="many-models.html#cb730-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4     2 c         3</span></span></code></pre></div>
<p>The same principle applies when unnesting list-columns of data frames. You can unnest multiple list-cols as long as all the data frames in each row have the same number of rows.</p>
</div>
<div id="exercises-70" class="section level3" number="25.5.3">
<h3><span class="header-section-number">25.5.3</span> Exercises</h3>
<ol style="list-style-type: decimal">
<li><p>Why might the <code>lengths()</code> function be useful for creating atomic
vector columns from list-columns?</p></li>
<li><p>List the most common types of vector found in a data frame. What makes
lists different?</p></li>
</ol>
</div>
</div>
<div id="making-tidy-data-with-broom" class="section level2" number="25.6">
<h2><span class="header-section-number">25.6</span> Making tidy data with broom</h2>
<p>The broom package provides three general tools for turning models into tidy data frames:</p>
<ol style="list-style-type: decimal">
<li><p><code>broom::glance(model)</code> returns a row for each model. Each column gives a
model summary: either a measure of model quality, or complexity, or a
combination of the two.</p></li>
<li><p><code>broom::tidy(model)</code> returns a row for each coefficient in the model. Each
column gives information about the estimate or its variability.</p></li>
<li><p><code>broom::augment(model, data)</code> returns a row for each row in <code>data</code>, adding
extra values like residuals, and influence statistics.</p></li>
</ol>

</div>
</div>



            </section>

          </div>
        </div>
      </div>
<a href="model-building.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="communicate-intro.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/hadley/r4ds/edit/master/model-many.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
